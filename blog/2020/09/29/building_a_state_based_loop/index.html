<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="theme-color" content="hsl(35, 36%, 95%)">

  <title>
    
        Building a State-Based Game Loop in Python
    
  </title>

  

  <meta
    name="description"
    content="
      
          
  
  
    Building a State-Based Game Loop in Python
    29 Sep 2020
    
      
    
  
  



  
  

    
    
    

    
     ..."
    />

  
  <meta name="keywords" content="
      
          
      
  " />

  <link
    rel="canonical"
    href="http://simulacrum.space/blog/2020/09/29/building_a_state_based_loop/"
    >
  
  <link
    rel="alternate"
    type="application/rss+xml"
    title="Simulacrum"
    href="http://simulacrum.space/feed.xml"
    >
  
  <meta name="author" content="Jonathan Crum">
      <span itemprop='author'>
  </span>

  <link href="/favicon.png" rel="icon">
    
  <link
    rel="stylesheet"
    href="//brick.a.ssl.fastly.net/PT+Serif:400,400i,700,700i:f/Source+Code+Pro:400,600:f"
    >

  <link
    rel="stylesheet"
    href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
    crossorigin="anonymous"
    >
  
  <link
    rel="stylesheet"
    href="/css/main.css"
    >

  <script type="text/javascript">
    window.MathJax = {
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
      },

      TeX: {
        equationNumbers: { autoNumber: "AMS" }
      },

      CommonHTML: {
        scale: 90
      }
    };
  </script>
  <script
    type="text/javascript" async
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"
  ></script>

  <script>
    (function(i,s,o,g,r,a,m){
	i['GoogleAnalyticsObject'] = r;
	i[r] = i[r] || function() {
	    (i[r].q = i[r].q || []).push(arguments)
	}, i[r].l = 1 * new Date();
	a = s.createElement(o), m = s.getElementsByTagName(o)[0];
	a.async = 1;
	a.src = g;
	m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', '', 'auto');
    ga('send', 'pageview');
  </script>

  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://d3js.org/d3-hexbin.v0.2.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
  <script src="https://use.fontawesome.com/4bee85bf94.js"></script>

  
</head>


  <body>
    
    <div class="container main">
      <div class="row navbar">
  
  <div class="col-6">
    
    <a
      class="fa fa-github"
      href="https://github.com/krummja"
      title="GitHub"
    ></a>
    
  </div>
  
  <div class="col-6 text-right">
    <a class="fa fa-home" href="/"></a>
  </div>
  
</div>

      
      <div class="row justify-content-center">
  
  <header class="col-md-12 text-center mt-3">
    <span itemprop="name" class="p1-3 pr-3"><h1>Building a State-Based Game Loop in Python</h1></span>
    <p>29 Sep 2020</p>
    <span class="small-ornament"><svg viewBox="0 0 290 320">
      <path d="M280.2656 245.3906 Q280.2656 263.25 261.8438 271.9688 Q247.9219 278.7188 227.8125 278.7188 Q235.2656 269.8594 235.2656 256.5 Q235.2656 231.8906 214.4531 217.125 Q196.0312 204.0469 170.2969 204.0469 Q143.5781 204.0469 108.8438 221.0625 L118.9688 231.4688 Q154.4062 267.8906 168.3281 267.8906 Q181.125 267.8906 181.125 255.9375 Q181.125 248.3438 173.5312 243.5625 Q167.0625 239.3438 159.0469 239.3438 Q154.6875 239.3438 148.6406 241.4531 Q158.625 220.0781 173.9531 220.0781 Q184.5 220.0781 191.8828 228.0938 Q199.2656 236.1094 199.2656 246.6562 Q199.2656 265.5 184.3594 277.875 Q170.2969 289.4062 151.0312 289.4062 Q118.6875 289.4062 81.4219 251.0156 L72.1406 241.4531 Q53.5781 249.4688 39.375 249.4688 Q26.4375 249.4688 17.1562 240.9609 Q7.875 232.4531 7.875 219.5156 Q7.875 203.9062 19.125 193.9219 Q29.9531 184.5 45.8438 184.5 Q70.0312 184.5 98.2969 211.6406 Q111.5156 202.2188 127.5469 185.4844 L134.5781 178.1719 Q174.5156 136.6875 204.8906 136.6875 Q231.4688 136.6875 231.4688 155.25 Q231.4688 173.5312 204.3281 177.3281 Q206.4375 172.8281 206.4375 170.1562 Q206.4375 159.3281 193.3594 159.3281 Q175.2188 159.3281 144.2812 189 L137.1094 195.8906 Q165.2344 185.7656 191.25 185.7656 Q221.7656 185.7656 248.3438 200.1094 Q280.2656 217.2656 280.2656 245.3906 ZM61.1719 230.4844 Q44.5781 215.2969 37.2656 215.2969 Q27.9844 215.2969 27.9844 223.4531 Q27.9844 234.4219 42.75 234.4219 Q51.1875 234.4219 61.1719 230.4844z"/>
    </svg></span>
  </header>
  
</div>

<div class="row justify-content-center">
  
  <div class="col-md-8">

    
    
    

    <article lang="en">
      
<p>The core of the Simulacra engine is a state-based game loop, itself an extension of the <code class="language-plaintext highlighter-rouge">EventDispatch</code> class provided by the TCOD library. To get started, we want to define a base <code class="language-plaintext highlighter-rouge">State</code> class, from which we will extend all of the game’s relevant states.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Generic</span><span class="p">,</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">TYPE_CHECKING</span>

<span class="kn">import</span> <span class="nn">tcod.event</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">tcod.console</span> <span class="k">as</span> <span class="n">Console</span>


<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s">"T"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">State</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">tcod</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">EventDispatch</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>

    <span class="k">def</span> <span class="nf">loop</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">State</span><span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">ev_keydown</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">State</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">event</span><span class="p">:</span> <span class="n">tcod</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">KeyDown</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
        <span class="k">pass</span>
</code></pre></div></div>

<p>Let’s unpack what’s happening here. I’ll assume little to no familiarity with using type hinting in Python, just for the sake of completeness. First we import the <code class="language-plaintext highlighter-rouge">annotations</code> feature from Python’s <code class="language-plaintext highlighter-rouge">__future__</code> module. This feature was introduced in <a href="https://www.python.org/dev/peps/pep-0563/">PEP 563</a> to permit forward reference to type annotations (e.g. if I want to annotate a variable <code class="language-plaintext highlighter-rouge">some_variable: MyType</code> before <code class="language-plaintext highlighter-rouge">MyType</code> is actually defined, which is often the case).</p>

<p>Once we have the annotations feature, we’ll also want to import a number of type aliases from the <code class="language-plaintext highlighter-rouge">typing</code> module. I’ll discuss each of these as we run into it in the code, with the exception of the final one: <code class="language-plaintext highlighter-rouge">typing.TYPE_CHECKING</code>. This handy constant is assumed to be <code class="language-plaintext highlighter-rouge">True</code> by 3rd party type checkers, but <code class="language-plaintext highlighter-rouge">False</code> at runtime; the practical effect is that we can import our local modules for typing purposes without running into annoying circular dependency errors at runtime.</p>

<p>Alright, so let’s get to the heart of things.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s">"T"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">State</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">tcod</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">EventDispatch</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
    <span class="c1"># ...
</span></code></pre></div></div>

<p>Our base <code class="language-plaintext highlighter-rouge">State</code> class inherits from the <code class="language-plaintext highlighter-rouge">Generic</code> base class and the <code class="language-plaintext highlighter-rouge">EventDispatch</code> class from the TCOD library’s <code class="language-plaintext highlighter-rouge">event</code> module. We specified a type variable <code class="language-plaintext highlighter-rouge">T</code>, which allows us to abstract away from the specific type we expect the <code class="language-plaintext highlighter-rouge">State</code> object to deal with. One way to think of this is that we are specifying a ’domain’ that the <code class="language-plaintext highlighter-rouge">State</code> object will be responsible for, and we can leverage this type variable to specify operations that work with data in this domain. This will make more sense in a moment when we define the concrete class that will replace the type variable in the actual implementation.</p>

<p>The <code class="language-plaintext highlighter-rouge">tcod.event.EventDispatch</code> class is a basic… er, event dispatcher. Specifically, it pays attention to various of its own methods (the ones defined with the prefix <code class="language-plaintext highlighter-rouge">ev_</code>) and handles the dispatching of input events to these methods. Our <code class="language-plaintext highlighter-rouge">State</code> object, in effect, is built on top of a very useful set of input event handlers that we can begin to work into the foundation of the game’s I/O. With that in mind, we can go ahead and modify the <code class="language-plaintext highlighter-rouge">State.loop()</code> method we defined in the abstract above.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">loop</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">State</span><span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">tcod</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">wait</span><span class="p">():</span>
                <span class="c1"># ...
</span></code></pre></div></div>

<p>Note firstly the annotation we’ve given for the return type of the loop. The type <code class="language-plaintext highlighter-rouge">Optional[T]</code> means that sometimes we’ll get a return type of <code class="language-plaintext highlighter-rouge">None</code>, but other times we’ll get whatever the type <code class="language-plaintext highlighter-rouge">T</code> is from the domain our <code class="language-plaintext highlighter-rouge">State</code> is responsible for. The <code class="language-plaintext highlighter-rouge">tcod.event.wait()</code> method will sit around twiddling its thumbs until input events start pouring in, at which point it will return an iterator containing all pending events. The details of this aren’t too important right now; the thing we’ll want to use for our purposes is the <code class="language-plaintext highlighter-rouge">event</code> variable that ranges over the elements of this returned iterator. We want to toss each <code class="language-plaintext highlighter-rouge">event</code> to the dispatcher, and what we’ll get back is either <code class="language-plaintext highlighter-rouge">None</code> or some valid value that we can proceed with.</p>

<p>We want to leverage this behavior to handle what happens in each case. If we return <code class="language-plaintext highlighter-rouge">None</code>, we want this to break our loop. This is possible because <code class="language-plaintext highlighter-rouge">None</code> is falsy, and therefore allows us to break our <code class="language-plaintext highlighter-rouge">while</code> loop. If we return anything else, we want to treat that as a valid return from our event dispatch and do some more work with it. Above our <code class="language-plaintext highlighter-rouge">State</code> class, let’s add a new class that will extend the built-in <code class="language-plaintext highlighter-rouge">Exception</code> class:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">StateBreak</span><span class="p">(</span><span class="nb">Exception</span><span class="p">):</span>
    <span class="s">"""Breaks out of the active State.loop and forces it to return None."""</span>
</code></pre></div></div>

<p>We can throw this into our loop as a <code class="language-plaintext highlighter-rouge">try ... except</code> statement to neatly handle our two possibilities.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                <span class="k">try</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">StateBreak</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">None</span>
</code></pre></div></div>

<p>All that’s left now is to handle what happens if <code class="language-plaintext highlighter-rouge">value</code> is not <code class="language-plaintext highlighter-rouge">None</code>, and so, <code class="language-plaintext highlighter-rouge">if value is not None:</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">loop</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">State</span><span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">tcod</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">wait</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">StateBreak</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">None</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></div>

<p>We’ll return <code class="language-plaintext highlighter-rouge">value</code>. But what exactly is <code class="language-plaintext highlighter-rouge">value</code>? It can be anything we want, really - but the easiest thing to make it is something that we can use to link our keyboard events to functions that will in turn send out things of type <code class="language-plaintext highlighter-rouge">T</code>. By itself, this isn’t going to do a whole lot, of course. We can go ahead and provide an implementation for the <code class="language-plaintext highlighter-rouge">EventDispatch</code> class’s <code class="language-plaintext highlighter-rouge">ev_keydown</code> method, which will allow us to subscribe to any incoming key press events.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">ev_keydown</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">State</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">event</span><span class="p">:</span> <span class="n">tcod</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">KeyDown</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
        <span class="k">pass</span>
</code></pre></div></div>

<p>Let’s get used to thinking about these in terms of their types. The method <code class="language-plaintext highlighter-rouge">State.ev_keydown()</code> is looking to take in some event of type <code class="language-plaintext highlighter-rouge">tcod.event.KeyDown</code> and will return either <code class="language-plaintext highlighter-rouge">None</code>, in which case nothing at all happens, or <code class="language-plaintext highlighter-rouge">T</code>. Because we only actually return <code class="language-plaintext highlighter-rouge">None</code> in the case that we explicitly tell it to, the fact that we might sometimes return <code class="language-plaintext highlighter-rouge">None</code> is not an issue.</p>

<p>Now, there are a ton of ways this could be implemented, but the way that I think is most flexible is to use a version of the Command pattern (on which read this wonderful section of <a href="http://gameprogrammingpatterns.com/command.html">Game Programing Patterns</a>). In this implementation, we’re going to create a tight linkage between the names of the methods and the symbols that get called when we perform certain commands, effectively allowing us to modify our command structure by (1) adding a new entry to the list of possible commands, and (2) creating a new command method. Here’s an abstract of what I mean. First, add <code class="language-plaintext highlighter-rouge">Callable</code> and <code class="language-plaintext highlighter-rouge">Dict</code> to our import from <code class="language-plaintext highlighter-rouge">typing</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Generic</span><span class="p">,</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">TYPE_CHECKING</span>
</code></pre></div></div>

<p>And this is how the structure of <code class="language-plaintext highlighter-rouge">State</code> will end up looking:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">State</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">tcod</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">EventDispatch</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>

    <span class="n">COMMANDS</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">tcod</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">K_RETURN</span><span class="p">:</span> <span class="s">"confirm"</span><span class="p">,</span>
        <span class="n">tcod</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">K_ESCAPE</span><span class="p">:</span> <span class="s">"escape"</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">ev_keydown</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">State</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">event</span><span class="p">:</span> <span class="n">tcod</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">KeyDown</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
        <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">Optional</span><span class="p">[</span><span class="n">T</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">sym</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">COMMANDS</span><span class="p">:</span>
            <span class="n">func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="s">"cmd_{self.COMMAND[event.sym]}"</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">cmd_confirm</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">State</span><span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">cmd_escape</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">State</span><span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
        <span class="k">pass</span>
</code></pre></div></div>

<p>Alright, so some explanation is in order. Inside of our <code class="language-plaintext highlighter-rouge">State</code> object, we’re defining a dictionary that maps the <code class="language-plaintext highlighter-rouge">int</code> type keycodes to strings. These strings are the names of specific commands: notice that for <code class="language-plaintext highlighter-rouge">tcod.event.K_RETURN: "confirm"</code> we have a corresponding method <code class="language-plaintext highlighter-rouge">State.cmd_confirm(...)</code> which returns <code class="language-plaintext highlighter-rouge">None</code> or <code class="language-plaintext highlighter-rouge">T</code>. The way we handle this mapping in terms of the actual event dispatcher is to read the <code class="language-plaintext highlighter-rouge">sym</code> attribute of the <code class="language-plaintext highlighter-rouge">tcod.event.KeyDown</code> event, which is the integer keycode. For example, if I press <code class="language-plaintext highlighter-rouge">Enter</code> on my keyboard, <code class="language-plaintext highlighter-rouge">tcod.event.KeyDown.sym</code> will be <code class="language-plaintext highlighter-rouge">13</code>. We’ve defined a variable <code class="language-plaintext highlighter-rouge">func</code> that is of type <code class="language-plaintext highlighter-rouge">Callable[[], Optional[T]]</code>, which is to say a function that takes in no arguments and returns something of type <code class="language-plaintext highlighter-rouge">Optional[T]</code>.</p>

<p>When the dispatcher returns <code class="language-plaintext highlighter-rouge">13</code> for <code class="language-plaintext highlighter-rouge">event.sym</code>, we plug that into the f-string that is fed into <code class="language-plaintext highlighter-rouge">getattr</code>, ultimately assigned to <code class="language-plaintext highlighter-rouge">func</code>. What we get back is a Python symbol <code class="language-plaintext highlighter-rouge">State.cmd_</code> + whatever <code class="language-plaintext highlighter-rouge">13</code> maps to in our dictionary, in this case <code class="language-plaintext highlighter-rouge">confirm</code>. The end result is that we’ve generated a symbol <code class="language-plaintext highlighter-rouge">State.cmd_confirm</code>. We then return a call of that function: <code class="language-plaintext highlighter-rouge">return func()</code>, or <code class="language-plaintext highlighter-rouge">return State.cmd_confirm()</code>.</p>

<p>We can then put concrete statements into the implementation of this method, which is especially useful since we’ll be overriding this method classes that inherit from <code class="language-plaintext highlighter-rouge">State</code>. And with that, we have the core of our event-based state engine.</p>


    </article>

    
  </div>
  
</div>

    </div>
    
    <footer class="mb-3">
  
  <div class="container">
    
    <div class="row biography">
      <div class="col-sm-6">
        <h2>who am i</h2>
        <p>My name is Jonathan Crum, and I am a PhD student at the University of Georgia working in the area of theoretical linguistics.
My current research interests have led me to the study of incorporation phenomena; this project is part of a larger set of projects that aim to investigate the relationship between syntax and semantics, particularly as applied to the interpretation of predicates.</p>
        <p></p>
      </div>
      
      <div class="col-sm-6">
        <h2>what is this</h2>
        <p>A digital garden - a blog and personal notebook. I post intermittently about a wide variety of things, related to linguistics, writing, programming, and other side interests. I also use this site to host content for the writing courses I support at UGA.</p>
      </div>  
    </div>
    
    
    <div class="row copyright text-center">
      <div class="col-sm-12">© 2019-2020 by Jonathan Crum.</div>
    </div>
    

  </div>
  
</footer>

    
  </body>

  <!-- JavaScript Injection -->
  

  <!-- Markdown Mermaid -->
  

  <!-- Markdown Highlight -->
  
</html>
