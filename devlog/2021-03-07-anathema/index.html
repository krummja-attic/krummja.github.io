<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>simulacrum</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content=""><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css2?family=PT+Serif&display=swap"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css2?family=PT+Serif:wght@700&display=swap"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Caveat&display=swap"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Pangolin&display=swap"><script data-n-head="ssr" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_HTML"></script><script data-n-head="ssr" src="https://d3js.org/d3.v6.min.js"></script><script data-n-head="ssr" src="//unpkg.com/graphre/dist/graphre.js"></script><script data-n-head="ssr" src="//unpkg.com/nomnoml/dist/nomnoml.js"></script><link rel="preload" href="/_nuxt/ac44da6.js" as="script"><link rel="preload" href="/_nuxt/d026428.js" as="script"><link rel="preload" href="/_nuxt/7f5f87e.js" as="script"><link rel="preload" href="/_nuxt/52d3781.js" as="script"><link rel="preload" href="/_nuxt/4b85684.js" as="script"><link rel="preload" href="/_nuxt/d971605.js" as="script"><style data-vue-ssr-id="0211d3d2:0 2e714118:0 517a8dd7:0 fa7ff0ca:0 5c346d62:0 5c346d62:1 5c346d62:2 5c346d62:3 72ac755c:0 308dcbe2:0 b23bd908:0 a4d88c8c:0 2e807e6a:0 7480e6b4:0">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,"Segoe UI","Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5}*,:after,:before{box-sizing:border-box;border:0 solid #e2e8f0}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#a0aec0}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#a0aec0}input::placeholder,textarea::placeholder{color:#a0aec0}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit}code,kbd,pre,samp{font-family:Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}.container{width:100%}@media (min-width:320px){.container{max-width:320px}}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}@media (min-width:1351px){.container{max-width:1351px}}.bg-transparent{background-color:transparent}.hover\:border-purple-700:hover{--border-opacity:1;border-color:#6b46c1;border-color:rgba(107,70,193,var(--border-opacity))}.rounded{border-radius:.25rem}.rounded-full{border-radius:9999px}.rounded-b{border-bottom-right-radius:.25rem;border-bottom-left-radius:.25rem}.border{border-width:1px}.block{display:block}.flex{display:flex}.table{display:table}.hidden{display:none}.flex-row{flex-direction:row}.flex-row-reverse{flex-direction:row-reverse}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.place-self-auto{align-self:auto;justify-self:auto;place-self:auto}.justify-between{justify-content:space-between}.font-medium{font-weight:500}.font-bold{font-weight:700}.h-48{height:12rem}.text-sm{font-size:.875rem}.text-base{font-size:1rem}.text-lg{font-size:1.125rem}.text-2xl{font-size:1.5rem}.text-3xl{font-size:1.875rem}.text-4xl{font-size:2.25rem}.my-6{margin-top:1.5rem;margin-bottom:1.5rem}.my-10{margin-top:2.5rem;margin-bottom:2.5rem}.mx-auto{margin-left:auto;margin-right:auto}.mt-2{margin-top:.5rem}.mb-2{margin-bottom:.5rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.mb-10{margin-bottom:2.5rem}.object-cover{-o-object-fit:cover;object-fit:cover}.p-5{padding:1.25rem}.p-6{padding:1.5rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-5{padding-left:1.25rem;padding-right:1.25rem}.pr-6{padding-right:1.5rem}.static{position:static}.sticky{position:-webkit-sticky;position:sticky}.shadow-sm{box-shadow:0 1px 2px 0 rgba(0,0,0,.05)}.shadow-md{box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)}.shadow-lg{box-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -2px rgba(0,0,0,.05)}.hover\:shadow-md:hover{box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)}.text-center{text-align:center}.text-gray-600{--text-opacity:1;color:#718096;color:rgba(113,128,150,var(--text-opacity))}.text-purple-900{--text-opacity:1;color:#44337a;color:rgba(68,51,122,var(--text-opacity))}.hover\:text-gray-900:hover{--text-opacity:1;color:#1a202c;color:rgba(26,32,44,var(--text-opacity))}.hover\:text-purple-600:hover{--text-opacity:1;color:#805ad5;color:rgba(128,90,213,var(--text-opacity))}.italic{font-style:italic}.tracking-wide{letter-spacing:.025em}.tracking-wider{letter-spacing:.05em}.invisible{visibility:hidden}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.w-16{width:4rem}.w-1\/2{width:50%}.w-full{width:100%}.transform{--transform-translate-x:0;--transform-translate-y:0;--transform-rotate:0;--transform-skew-x:0;--transform-skew-y:0;--transform-scale-x:1;--transform-scale-y:1;transform:translateX(var(--transform-translate-x)) translateY(var(--transform-translate-y)) rotate(var(--transform-rotate)) skewX(var(--transform-skew-x)) skewY(var(--transform-skew-y)) scaleX(var(--transform-scale-x)) scaleY(var(--transform-scale-y))}.transition-colors{transition-property:background-color,border-color,color,fill,stroke}.transition-shadow{transition-property:box-shadow}.ease-linear{transition-timing-function:linear}.ease-in-out{transition-timing-function:cubic-bezier(.4,0,.2,1)}.duration-75{transition-duration:75ms}.duration-150{transition-duration:.15s}.duration-300{transition-duration:.3s}@-webkit-keyframes spin{to{transform:rotate(1turn)}}@keyframes spin{to{transform:rotate(1turn)}}@-webkit-keyframes ping{75%,to{transform:scale(2);opacity:0}}@keyframes ping{75%,to{transform:scale(2);opacity:0}}@-webkit-keyframes pulse{50%{opacity:.5}}@keyframes pulse{50%{opacity:.5}}@-webkit-keyframes bounce{0%,to{transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1)}}@keyframes bounce{0%,to{transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1)}}@media (min-width:320px){.xs\:container{width:100%}}@media (min-width:320px) and (min-width:320px){.xs\:container{max-width:320px}}@media (min-width:320px) and (min-width:640px){.xs\:container{max-width:640px}}@media (min-width:320px) and (min-width:768px){.xs\:container{max-width:768px}}@media (min-width:320px) and (min-width:1024px){.xs\:container{max-width:1024px}}@media (min-width:320px) and (min-width:1280px){.xs\:container{max-width:1280px}}@media (min-width:320px) and (min-width:1351px){.xs\:container{max-width:1351px}}@media (min-width:320px){.xs\:flex-col{flex-direction:column}.xs\:text-sm{font-size:.875rem}.xs\:text-xl{font-size:1.25rem}.xs\:text-2xl{font-size:1.5rem}.xs\:text-3xl{font-size:1.875rem}.xs\:my-2{margin-top:.5rem;margin-bottom:.5rem}.xs\:my-4{margin-top:1rem;margin-bottom:1rem}.xs\:mb-6{margin-bottom:1.5rem}.xs\:w-24{width:6rem}.xs\:w-full{width:100%}}@media (min-width:640px){.sm\:container{width:100%}}@media (min-width:640px) and (min-width:320px){.sm\:container{max-width:320px}}@media (min-width:640px) and (min-width:640px){.sm\:container{max-width:640px}}@media (min-width:640px) and (min-width:768px){.sm\:container{max-width:768px}}@media (min-width:640px) and (min-width:1024px){.sm\:container{max-width:1024px}}@media (min-width:640px) and (min-width:1280px){.sm\:container{max-width:1280px}}@media (min-width:640px) and (min-width:1351px){.sm\:container{max-width:1351px}}@media (min-width:640px){.sm\:flex-col{flex-direction:column}.sm\:text-sm{font-size:.875rem}.sm\:mx-1{margin-left:.25rem;margin-right:.25rem}.sm\:mx-8{margin-left:2rem;margin-right:2rem}.sm\:w-24{width:6rem}.sm\:w-1\/2{width:50%}}@media (min-width:768px){.md\:container{width:100%}}@media (min-width:768px) and (min-width:320px){.md\:container{max-width:320px}}@media (min-width:768px) and (min-width:640px){.md\:container{max-width:640px}}@media (min-width:768px) and (min-width:768px){.md\:container{max-width:768px}}@media (min-width:768px) and (min-width:1024px){.md\:container{max-width:1024px}}@media (min-width:768px) and (min-width:1280px){.md\:container{max-width:1280px}}@media (min-width:768px) and (min-width:1351px){.md\:container{max-width:1351px}}@media (min-width:768px){.md\:flex-row{flex-direction:row}.md\:text-base{font-size:1rem}.md\:text-xl{font-size:1.25rem}.md\:text-2xl{font-size:1.5rem}.md\:text-3xl{font-size:1.875rem}.md\:text-5xl{font-size:3rem}.md\:my-8{margin-top:2rem;margin-bottom:2rem}.md\:mx-8{margin-left:2rem;margin-right:2rem}.md\:mx-16{margin-left:4rem;margin-right:4rem}.md\:mt-8{margin-top:2rem}.md\:mb-8{margin-bottom:2rem}.md\:mb-12{margin-bottom:3rem}.md\:w-32{width:8rem}.md\:w-1\/2{width:50%}.md\:w-1\/3{width:33.333333%}.md\:w-full{width:100%}}@media (min-width:1024px){.lg\:container{width:100%}}@media (min-width:1024px) and (min-width:320px){.lg\:container{max-width:320px}}@media (min-width:1024px) and (min-width:640px){.lg\:container{max-width:640px}}@media (min-width:1024px) and (min-width:768px){.lg\:container{max-width:768px}}@media (min-width:1024px) and (min-width:1024px){.lg\:container{max-width:1024px}}@media (min-width:1024px) and (min-width:1280px){.lg\:container{max-width:1280px}}@media (min-width:1024px) and (min-width:1351px){.lg\:container{max-width:1351px}}@media (min-width:1024px){.lg\:flex-row{flex-direction:row}.lg\:flex-col{flex-direction:column}.lg\:flex-1{flex:1 1 0%}.lg\:text-lg{font-size:1.125rem}.lg\:mx-16{margin-left:4rem;margin-right:4rem}.lg\:mx-32{margin-left:8rem;margin-right:8rem}.lg\:w-48{width:12rem}.lg\:w-1\/2{width:50%}}@media (min-width:1280px){.xl\:container{width:100%}}@media (min-width:1280px) and (min-width:320px){.xl\:container{max-width:320px}}@media (min-width:1280px) and (min-width:640px){.xl\:container{max-width:640px}}@media (min-width:1280px) and (min-width:768px){.xl\:container{max-width:768px}}@media (min-width:1280px) and (min-width:1024px){.xl\:container{max-width:1024px}}@media (min-width:1280px) and (min-width:1280px){.xl\:container{max-width:1280px}}@media (min-width:1280px) and (min-width:1351px){.xl\:container{max-width:1351px}}@media (min-width:1280px){.xl\:text-xl{font-size:1.25rem}.xl\:mx-24{margin-left:6rem;margin-right:6rem}.xl\:mx-64{margin-left:16rem;margin-right:16rem}.xl\:visible{visibility:visible}.xl\:w-48{width:12rem}.xl\:w-1\/3{width:33.333333%}}@media (min-width:1351px){.xxlmin\:container{width:100%}}@media (min-width:1351px) and (min-width:320px){.xxlmin\:container{max-width:320px}}@media (min-width:1351px) and (min-width:640px){.xxlmin\:container{max-width:640px}}@media (min-width:1351px) and (min-width:768px){.xxlmin\:container{max-width:768px}}@media (min-width:1351px) and (min-width:1024px){.xxlmin\:container{max-width:1024px}}@media (min-width:1351px) and (min-width:1280px){.xxlmin\:container{max-width:1280px}}@media (min-width:1351px) and (min-width:1351px){.xxlmin\:container{max-width:1351px}}@media (min-width:1351px){.xxlmin\:w-1\/2{width:50%}}@media (max-width:1350px){.xxlmax\:container{width:100%}}@media (max-width:1350px) and (min-width:320px){.xxlmax\:container{max-width:320px}}@media (max-width:1350px) and (min-width:640px){.xxlmax\:container{max-width:640px}}@media (max-width:1350px) and (min-width:768px){.xxlmax\:container{max-width:768px}}@media (max-width:1350px) and (min-width:1024px){.xxlmax\:container{max-width:1024px}}@media (max-width:1350px) and (min-width:1280px){.xxlmax\:container{max-width:1280px}}@media (max-width:1350px) and (min-width:1351px){.xxlmax\:container{max-width:1351px}}@media (max-width:1350px){.xxlmax\:flex-col{flex-direction:column}.xxlmax\:w-full{width:100%}}code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,"Andale Mono","Ubuntu Mono",monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}html{font-family:"PT Serif",Georgia,Times,"Times New Roman",serif;background-color:#ede5d9;color:#2d2d2d;font-size:16px;word-spacing:1px;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;box-sizing:border-box}*,:after,:before{box-sizing:border-box;margin:0}.container{height:100%;text-align:center}.content-wrapper{height:100%;padding:40px 30px;background-color:#f7f3ef}.colorpop{height:20px;width:100%;bottom:20px;background-color:rgba(75,60,90,.8)}.colorpop,.nuxt-content{position:relative}.nuxt-content a{color:#4b3c5a;text-decoration:none;font-weight:600;box-shadow:inset 0 -.225rem 0 0 #f7f3ef,inset 0 -.475rem 0 0 rgba(115,90,140,.25)}.nuxt-content h1,.nuxt-content h2{color:rgba(75,60,90,.8);font-weight:700;font-size:28px}.nuxt-content h2{padding-top:30px}.nuxt-content h3{color:rgba(75,60,90,.8);padding-top:30px;font-weight:700;font-size:22px}.nuxt-content h4{color:rgba(75,60,90,.8);margin-top:30px;font-style:italic;font-size:20px}.nuxt-content p{margin:16px 0}.nuxt-content ol{margin:32px 0;padding:0 60px;list-style-type:decimal}.nuxt-content ul{margin:32px 0;padding:0 60px;list-style-type:circle}.nuxt-content li{padding-left:10px}.nuxt-content pre{margin:60px 0;border-radius:8px;box-shadow:inset 0 0 10px rgba(0,0,0,.1);background:#ede5d9}.nuxt-content pre code{font-size:12pt;border-radius:0;padding:0;box-shadow:none;background:0 0}.nuxt-content pre code span.token.operator{background:0 0}.nuxt-content .dropcap{color:#4b3c5a;float:left;font-size:75px;line-height:60px;padding-top:4px;padding-right:8px;padding-left:3px}.nuxt-content .footnotes{margin-top:150px}.nuxt-content .footnotes li{margin-top:8px}.nuxt-content .footnotes:before{content:"References";color:rgba(75,60,90,.8);font-weight:700;font-size:28px}.nuxt-content .footnote-ref{color:#4b3c5a}.nuxt-content .footnote-backref{margin-left:6px;color:#4b3c5a}code{padding:0 5px;background:#ede5d9;border-radius:8px;box-shadow:inset 0 0 10px rgba(0,0,0,.1);font-size:12pt}.logo[data-v-16a2ac09],.title[data-v-16a2ac09]{color:rgba(75,60,90,.8)}.logo[data-v-16a2ac09]{display:block;margin:24px auto 4px}.tab-primary[data-v-97c48cae]{font-weight:700;color:#5e5e5e;background-color:#f7f3ef}.tab-secondary[data-v-97c48cae]{font-weight:400;color:#5e5e5e;background-color:#c9c2b7}.tab-ternary[data-v-97c48cae]{font-weight:700;color:#5e5e5e;background-color:#f7f3ef}.tab[data-v-97c48cae]{padding-top:2px;width:120px;height:30px;border-radius:10px 10px 0 0;font-size:1rem}.container[data-v-8488c362]{height:100%}.log-header[data-v-8488c362]{text-align:center;width:100%}.log[data-v-8488c362]{text-align:justify}.log-title[data-v-8488c362]{color:rgba(75,60,90,.8)}.project-title a[data-v-8488c362]{color:#4b3c5a;text-decoration:none;font-weight:600;box-shadow:inset 0 -.2rem 0 0 #f7f3ef,inset 0 -.6rem 0 0 rgba(115,90,140,.25)}@media (min-width:320px){.nuxt-content code[data-v-8488c362],.nuxt-content pre code[data-v-8488c362]{font-size:.75rem}}@media (min-width:640px){.nuxt-content code[data-v-8488c362],.nuxt-content pre code[data-v-8488c362]{font-size:.875rem}}@media (min-width:768px){.nuxt-content code[data-v-8488c362],.nuxt-content pre code[data-v-8488c362]{font-size:1rem}}@media (min-width:1024px){.nuxt-content code[data-v-8488c362],.nuxt-content pre code[data-v-8488c362]{font-size:1rem}}.wrapper[data-v-7c884151]{position:-webkit-sticky;position:sticky;top:30px}.toc[data-v-7c884151]{position:absolute;text-align:left;left:-40px;padding:20px;background-color:#f7f3ef}.toc2[data-v-7c884151]{font-weight:700}.toc3[data-v-7c884151]{padding-left:10px}.wrapper[data-v-d89ed6e0]{min-width:250px;max-height:250px;font-family:Pangolin,cursive;font-weight:400;z-index:1;float:right;position:absolute;left:100%;padding:10px;margin-left:10px;color:#333;background-color:#ffeca9}.sticky[data-v-d89ed6e0]{width:auto}.sticky[data-v-d89ed6e0]:after{content:"";display:block;padding-bottom:100%}.copyright[data-v-2995466f]{text-align:center;color:#909090}</style><link rel="preload" href="/_nuxt/static/1615344676/devlog/2021-03-07-anathema/state.js" as="script"><link rel="preload" href="/_nuxt/static/1615344676/devlog/2021-03-07-anathema/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1615344676/manifest.js" as="script">
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div class="container mx-auto bg-transparent"><div data-v-16a2ac09><a href="/" class="nuxt-link-active" data-v-16a2ac09><div data-v-16a2ac09><img src="/logo.svg" class="logo w-16 xs:w-24 sm:w-24 md:w-32 lg:w-48 xl:w-48" data-v-16a2ac09></div> <h1 class="title xs:text-3xl md:text-5xl font-bold tracking-wide" data-v-16a2ac09>
        Simulacrum
    </h1> <h2 class="title md:mb-8 xs:text-xl md:text-xl" data-v-16a2ac09>Jonathan Crum's digital garden</h2></a></div> <div class="flex flex-row" data-v-97c48cae><a href="/" class="tab tab-primary tab-secondary" data-v-97c48cae>Blog</a> <a href="/notebookIndex" class="tab tab-secondary" data-v-97c48cae>Notebook</a> <a href="/devlogIndex" class="tab tab-secondary tab-ternary" data-v-97c48cae>Devlog</a></div> <div class="content-wrapper shadow-lg rounded"><div class="container" data-v-8488c362><div class="wrapper invisible xl:visible" data-v-7c884151 data-v-8488c362><ul class="toc shadow-lg" data-v-7c884151><li class="toc2" data-v-7c884151><a href="/devlog/2021-03-07-anathema#problem" class="transition-colors duration-75 text-base mb-2 block text-gray-600 hover:text-gray-900" data-v-7c884151>Problem</a></li><li class="toc2" data-v-7c884151><a href="/devlog/2021-03-07-anathema#base-case" class="transition-colors duration-75 text-base mb-2 block text-gray-600 hover:text-gray-900" data-v-7c884151>Base Case</a></li><li class="toc3" data-v-7c884151><a href="/devlog/2021-03-07-anathema#inputcontroller" class="transition-colors duration-75 text-base mb-2 block text-gray-600 hover:text-gray-900" data-v-7c884151>InputController</a></li><li class="toc3" data-v-7c884151><a href="/devlog/2021-03-07-anathema#playerready" class="transition-colors duration-75 text-base mb-2 block text-gray-600 hover:text-gray-900" data-v-7c884151>PlayerReady</a></li><li class="toc3" data-v-7c884151><a href="/devlog/2021-03-07-anathema#playermanager" class="transition-colors duration-75 text-base mb-2 block text-gray-600 hover:text-gray-900" data-v-7c884151>PlayerManager</a></li><li class="toc3" data-v-7c884151><a href="/devlog/2021-03-07-anathema#action-and-actionsystem" class="transition-colors duration-75 text-base mb-2 block text-gray-600 hover:text-gray-900" data-v-7c884151>Action and ActionSystem</a></li><li class="toc2" data-v-7c884151><a href="/devlog/2021-03-07-anathema#interim-comments" class="transition-colors duration-75 text-base mb-2 block text-gray-600 hover:text-gray-900" data-v-7c884151>Interim Comments</a></li></ul></div> <div class="log w-full px-2 xs:mb-6 md:mb-12" data-v-8488c362><div class="log-header" data-v-8488c362><h1 class="log-title tracking-wide font-bold xs:text-2xl md:text-3xl xs:my-4 md:mt-8 mb-2" data-v-8488c362>
        refactor/components
      </h1> <h2 class="project-title tracking-wide font-bold xs:text-xl md:text-2xl" data-v-8488c362><a href="https://github.com/krummja/Anathema" data-v-8488c362>Anathema</a></h2> <div class="xs:my-2 md:my-8" data-v-8488c362>
        March 7, 2021
      </div></div> <div class="log-body xs:text-sm sm:text-sm md:text-base lg:text-lg xl:text-xl sm:mx-1 md:mx-16 lg:mx-32 xl:mx-64" data-v-8488c362><div class="nuxt-content" data-v-8488c362 data-v-8488c362><h2 id="problem" data-v-8488c362 data-v-8488c362><a href="#problem" aria-hidden="true" tabindex="-1" data-v-8488c362 data-v-8488c362><span class="icon icon-link" data-v-8488c362 data-v-8488c362></span></a>Problem</h2>
<p data-v-8488c362 data-v-8488c362>Anathema's interaction system makes heavy use of the <code data-v-8488c362 data-v-8488c362>EntityEvent</code> class provided by <a href="https://github.com/krummja/ECStremity" rel="nofollow noopener noreferrer" target="_blank" data-v-8488c362 data-v-8488c362>ECStremity</a>. This works very well, but I have to do a couple of "hacky" things to route data from the player's <code data-v-8488c362 data-v-8488c362>Actor</code> component to the target interactable entity to the interface and systems logic.</p>
<p data-v-8488c362 data-v-8488c362>Currently I pass a <code data-v-8488c362 data-v-8488c362>dict</code> along as event data, usually with some field that contains an iterable I can collect usable information in. This can be a bit messy, especially when it comes to getting information to the UI, so I want to address that if I can.</p>
<p data-v-8488c362 data-v-8488c362>In this devlog, I want to write out some notes outlining how this works, ultimately aiming to tighten up the process to make it more reliable and easier to use.</p>
<h2 id="base-case" data-v-8488c362 data-v-8488c362><a href="#base-case" aria-hidden="true" tabindex="-1" data-v-8488c362 data-v-8488c362><span class="icon icon-link" data-v-8488c362 data-v-8488c362></span></a>Base Case</h2>
<p data-v-8488c362 data-v-8488c362>Let's take a look at an example of a basic interaction, say a player movement that touches some entity in the world that, on touch, triggers a state change in the entity. A prime example is a chest or other container, which we expect to (a) change visual state, and (b) raise a modal in the UI with options to select from. On selection of an option, some method on the entity's components should be fired, resulting in a change to the game state.</p>
<h3 id="inputcontroller" data-v-8488c362 data-v-8488c362><a href="#inputcontroller" aria-hidden="true" tabindex="-1" data-v-8488c362 data-v-8488c362><span class="icon icon-link" data-v-8488c362 data-v-8488c362></span></a>InputController</h3>
<p data-v-8488c362 data-v-8488c362>Inputs are handled by a manager class, <code data-v-8488c362 data-v-8488c362>Anathema.core.input.InputController</code>, which essentially wraps <code data-v-8488c362 data-v-8488c362>bearlibterminal</code>'s <code data-v-8488c362 data-v-8488c362>terminal.read</code> to get key events.</p>
<div class="nuxt-content-highlight" data-v-8488c362 data-v-8488c362><pre class="language-python line-numbers" data-v-8488c362 data-v-8488c362><code data-v-8488c362 data-v-8488c362><span class="token keyword" data-v-8488c362 data-v-8488c362>def</span> <span class="token function" data-v-8488c362 data-v-8488c362>handle_input</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>self<span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span> <span class="token operator" data-v-8488c362 data-v-8488c362>-</span><span class="token operator" data-v-8488c362 data-v-8488c362>></span> Optional<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span>Callable<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> <span class="token boolean" data-v-8488c362 data-v-8488c362>None</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
    terminal<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span> NiceTerminal <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>game<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>renderer<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>terminal
    key<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span> <span class="token builtin" data-v-8488c362 data-v-8488c362>int</span> <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> terminal<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>read<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span>

    <span class="token keyword" data-v-8488c362 data-v-8488c362>try</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
        command<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span> Callable<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> <span class="token boolean" data-v-8488c362 data-v-8488c362>None</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span> <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>command_lookup<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>key<span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span>
    <span class="token keyword" data-v-8488c362 data-v-8488c362>except</span> StateBreak<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
        <span class="token keyword" data-v-8488c362 data-v-8488c362>return</span> <span class="token boolean" data-v-8488c362 data-v-8488c362>None</span>
    <span class="token keyword" data-v-8488c362 data-v-8488c362>if</span> command <span class="token keyword" data-v-8488c362 data-v-8488c362>is</span> <span class="token keyword" data-v-8488c362 data-v-8488c362>not</span> <span class="token boolean" data-v-8488c362 data-v-8488c362>None</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
        <span class="token keyword" data-v-8488c362 data-v-8488c362>return</span> command
</code></pre></div>
<p data-v-8488c362 data-v-8488c362>On each input event, the <code data-v-8488c362 data-v-8488c362>key</code> is passed to a method <code data-v-8488c362 data-v-8488c362>command_lookup</code> on the <code data-v-8488c362 data-v-8488c362>InputController</code> and ultimately to a separate <code data-v-8488c362 data-v-8488c362>CommandLibrary</code>.</p>
<div class="nuxt-content-highlight" data-v-8488c362 data-v-8488c362><pre class="language-python line-numbers" data-v-8488c362 data-v-8488c362><code data-v-8488c362 data-v-8488c362><span class="token keyword" data-v-8488c362 data-v-8488c362>def</span> <span class="token function" data-v-8488c362 data-v-8488c362>command_lookup</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>self<span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> key<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span> <span class="token builtin" data-v-8488c362 data-v-8488c362>int</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span> <span class="token operator" data-v-8488c362 data-v-8488c362>-</span><span class="token operator" data-v-8488c362 data-v-8488c362>></span> Optional<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span>Callable<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> <span class="token boolean" data-v-8488c362 data-v-8488c362>None</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
    <span class="token keyword" data-v-8488c362 data-v-8488c362>if</span> key <span class="token keyword" data-v-8488c362 data-v-8488c362>in</span> CommandLibrary<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>MOVE_KEYS<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
        <span class="token keyword" data-v-8488c362 data-v-8488c362>return</span> self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>_current_screen<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>cmd_move<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span><span class="token operator" data-v-8488c362 data-v-8488c362>*</span>CommandLibrary<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>MOVE_KEYS<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span>key<span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span>
    <span class="token keyword" data-v-8488c362 data-v-8488c362>if</span> key <span class="token keyword" data-v-8488c362 data-v-8488c362>in</span> CommandLibrary<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>COMMAND_KEYS<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span>self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>_current_screen<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>name<span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
        commands <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> CommandLibrary<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>COMMAND_KEYS<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span>self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>_current_screen<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>name<span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span>
        <span class="token keyword" data-v-8488c362 data-v-8488c362>return</span> <span class="token builtin" data-v-8488c362 data-v-8488c362>getattr</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>_current_screen<span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> <span class="token string-interpolation" data-v-8488c362 data-v-8488c362><span class="token string" data-v-8488c362 data-v-8488c362>f"cmd_</span><span class="token interpolation" data-v-8488c362 data-v-8488c362><span class="token punctuation" data-v-8488c362 data-v-8488c362>{</span>commands<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span>key<span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>}</span></span><span class="token string" data-v-8488c362 data-v-8488c362>"</span></span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span>
    <span class="token keyword" data-v-8488c362 data-v-8488c362>elif</span> key <span class="token keyword" data-v-8488c362 data-v-8488c362>in</span> CommandLibrary<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>COMMAND_KEYS<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token string" data-v-8488c362 data-v-8488c362>'DEFAULT'</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
        commands <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> CommandLibrary<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>COMMAND_KEYS<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span>'DEFAULT<span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span>
        <span class="token keyword" data-v-8488c362 data-v-8488c362>return</span> <span class="token builtin" data-v-8488c362 data-v-8488c362>getattr</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>_current_screen<span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> <span class="token string-interpolation" data-v-8488c362 data-v-8488c362><span class="token string" data-v-8488c362 data-v-8488c362>f"cmd_</span><span class="token interpolation" data-v-8488c362 data-v-8488c362><span class="token punctuation" data-v-8488c362 data-v-8488c362>{</span>commands<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span>key<span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>}</span></span><span class="token string" data-v-8488c362 data-v-8488c362>"</span></span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span>
    <span class="token keyword" data-v-8488c362 data-v-8488c362>else</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
        <span class="token keyword" data-v-8488c362 data-v-8488c362>return</span> <span class="token boolean" data-v-8488c362 data-v-8488c362>None</span>
</code></pre></div>
<div id="1" class="wrapper shadow-md" style="transform:rotate(0);font-size:14pt" data-v-d89ed6e0 data-v-8488c362><div class="sticky" data-v-d89ed6e0>
One minor annoyance I should look into fixing is that I have to override the cmd_* methods in any Screen subclasses I don't want that behavior to be present in...
</div></div>
<p data-v-8488c362 data-v-8488c362>In short, a keyboard input is an <code data-v-8488c362 data-v-8488c362>int</code> that is checked against a dictionary of pre-defined methods on <code data-v-8488c362 data-v-8488c362>Screen</code> objects. These methods are all prefixed <code data-v-8488c362 data-v-8488c362>cmd_*</code>, making lookup and, ultimately, calling of the relevant methods fairly straightforward.<sup id="fnref-1" data-v-8488c362 data-v-8488c362><a href="#fn-1" class="footnote-ref" data-v-8488c362 data-v-8488c362>1</a></sup></p>
<p data-v-8488c362 data-v-8488c362>Of interest to the current use case is moving the player. So, we press an arrow key (or numpad key) on the keyboard, which returns something we can check against our <code data-v-8488c362 data-v-8488c362>CommandLibrary</code>.</p>
<div class="nuxt-content-highlight" data-v-8488c362 data-v-8488c362><pre class="language-python line-numbers" data-v-8488c362 data-v-8488c362><code data-v-8488c362 data-v-8488c362>MOVE_KEYS<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span> Dict<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token builtin" data-v-8488c362 data-v-8488c362>int</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> Tuple<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token builtin" data-v-8488c362 data-v-8488c362>int</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> <span class="token builtin" data-v-8488c362 data-v-8488c362>int</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span> <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> <span class="token punctuation" data-v-8488c362 data-v-8488c362>{</span>
    <span class="token comment" data-v-8488c362 data-v-8488c362># ...</span>
    blt<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>TK_UP<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span> <span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span><span class="token number" data-v-8488c362 data-v-8488c362>0</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> <span class="token operator" data-v-8488c362 data-v-8488c362>-</span><span class="token number" data-v-8488c362 data-v-8488c362>1</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span>
    <span class="token comment" data-v-8488c362 data-v-8488c362># ...</span>
    blt<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>TK_KP_8<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span> <span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span><span class="token number" data-v-8488c362 data-v-8488c362>0</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> <span class="token operator" data-v-8488c362 data-v-8488c362>-</span><span class="token number" data-v-8488c362 data-v-8488c362>1</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span>
    <span class="token comment" data-v-8488c362 data-v-8488c362># ...</span>
    <span class="token punctuation" data-v-8488c362 data-v-8488c362>}</span>
</code></pre></div>
<p data-v-8488c362 data-v-8488c362>In our <code data-v-8488c362 data-v-8488c362>InputController</code>, we're passing the dictionary value to <code data-v-8488c362 data-v-8488c362>cmd_move</code> on the currently active <code data-v-8488c362 data-v-8488c362>Screen</code>. During gameplay, this is our <code data-v-8488c362 data-v-8488c362>PlayerReady</code> screen, so let's see what happens there.</p>
<h3 id="playerready" data-v-8488c362 data-v-8488c362><a href="#playerready" aria-hidden="true" tabindex="-1" data-v-8488c362 data-v-8488c362><span class="icon icon-link" data-v-8488c362 data-v-8488c362></span></a>PlayerReady</h3>
<p data-v-8488c362 data-v-8488c362>It turns out not to be too interesting.</p>
<div class="nuxt-content-highlight" data-v-8488c362 data-v-8488c362><pre class="language-python line-numbers" data-v-8488c362 data-v-8488c362><code data-v-8488c362 data-v-8488c362><span class="token keyword" data-v-8488c362 data-v-8488c362>class</span> <span class="token class-name" data-v-8488c362 data-v-8488c362>PlayerReady</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>AbstractScreen<span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
    <span class="token comment" data-v-8488c362 data-v-8488c362># ...</span>
    <span class="token keyword" data-v-8488c362 data-v-8488c362>def</span> <span class="token function" data-v-8488c362 data-v-8488c362>cmd_move</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>self<span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> x<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span> <span class="token builtin" data-v-8488c362 data-v-8488c362>int</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> y<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span> <span class="token builtin" data-v-8488c362 data-v-8488c362>int</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span> <span class="token operator" data-v-8488c362 data-v-8488c362>-</span><span class="token operator" data-v-8488c362 data-v-8488c362>></span> <span class="token boolean" data-v-8488c362 data-v-8488c362>None</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
        self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>game<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>player<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>move<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>x<span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> y<span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span>
</code></pre></div>
<p data-v-8488c362 data-v-8488c362>Our method simply routes the tuple we got from our <code data-v-8488c362 data-v-8488c362>CommandLibrary</code> to the <code data-v-8488c362 data-v-8488c362>move</code> method on the game's <code data-v-8488c362 data-v-8488c362>PlayerManager</code>, so heading there...</p>
<h3 id="playermanager" data-v-8488c362 data-v-8488c362><a href="#playermanager" aria-hidden="true" tabindex="-1" data-v-8488c362 data-v-8488c362><span class="icon icon-link" data-v-8488c362 data-v-8488c362></span></a>PlayerManager</h3>
<p data-v-8488c362 data-v-8488c362>Aha, now we're talking! Now we have to handle some concrete logic. Note firstly that we store the player's position as a property, which is just for convenience.</p>
<div class="nuxt-content-highlight" data-v-8488c362 data-v-8488c362><pre class="language-python line-numbers" data-v-8488c362 data-v-8488c362><code data-v-8488c362 data-v-8488c362><span class="token keyword" data-v-8488c362 data-v-8488c362>class</span> <span class="token class-name" data-v-8488c362 data-v-8488c362>PlayerManager</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>AbstractManager<span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
    <span class="token comment" data-v-8488c362 data-v-8488c362># ...</span>
    <span class="token decorator annotation punctuation" data-v-8488c362 data-v-8488c362>@property</span>
    <span class="token keyword" data-v-8488c362 data-v-8488c362>def</span> <span class="token function" data-v-8488c362 data-v-8488c362>position</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>self<span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span> <span class="token operator" data-v-8488c362 data-v-8488c362>-</span><span class="token operator" data-v-8488c362 data-v-8488c362>></span> Tuple<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token builtin" data-v-8488c362 data-v-8488c362>int</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> <span class="token builtin" data-v-8488c362 data-v-8488c362>int</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
        <span class="token keyword" data-v-8488c362 data-v-8488c362>return</span> self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>entity<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token string" data-v-8488c362 data-v-8488c362>'Position'</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>xy
    <span class="token comment" data-v-8488c362 data-v-8488c362># ...</span>
</code></pre></div>
<p data-v-8488c362 data-v-8488c362>We use this property in our <code data-v-8488c362 data-v-8488c362>move</code> method:</p>
<div class="nuxt-content-highlight" data-v-8488c362 data-v-8488c362><pre class="language-python line-numbers" data-v-8488c362 data-v-8488c362><code data-v-8488c362 data-v-8488c362>    <span class="token comment" data-v-8488c362 data-v-8488c362># ...</span>
    <span class="token keyword" data-v-8488c362 data-v-8488c362>def</span> <span class="token function" data-v-8488c362 data-v-8488c362>move</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>self<span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> direction<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span> Tuple<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token builtin" data-v-8488c362 data-v-8488c362>int</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> <span class="token builtin" data-v-8488c362 data-v-8488c362>int</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span> <span class="token operator" data-v-8488c362 data-v-8488c362>-</span><span class="token operator" data-v-8488c362 data-v-8488c362>></span> <span class="token boolean" data-v-8488c362 data-v-8488c362>None</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
        target_x <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>position<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token number" data-v-8488c362 data-v-8488c362>0</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span> <span class="token operator" data-v-8488c362 data-v-8488c362>+</span> direction<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token number" data-v-8488c362 data-v-8488c362>0</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span>
        target_y <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>position<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token number" data-v-8488c362 data-v-8488c362>1</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span> <span class="token operator" data-v-8488c362 data-v-8488c362>+</span> direction<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token number" data-v-8488c362 data-v-8488c362>1</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span>
    <span class="token comment" data-v-8488c362 data-v-8488c362># ...</span>
</code></pre></div>
<p data-v-8488c362 data-v-8488c362>We compute a target position by adding our input offset to our current position. If position is <code data-v-8488c362 data-v-8488c362>(10, 12)</code> and we returned the value of <code data-v-8488c362 data-v-8488c362>blt.TK_UP</code>, then we'll get an updated position <code data-v-8488c362 data-v-8488c362>(10, 11)</code>. Simple!</p>
<p data-v-8488c362 data-v-8488c362>Now, in a completely featureless environment where we don't care about collisions or other entities, we simply pass this new position to an <code data-v-8488c362 data-v-8488c362>Action</code> which we enqueue to be executed on the next turn.</p>
<div class="nuxt-content-highlight" data-v-8488c362 data-v-8488c362><pre class="language-python line-numbers" data-v-8488c362 data-v-8488c362><code data-v-8488c362 data-v-8488c362>    <span class="token comment" data-v-8488c362 data-v-8488c362># ...</span>
    self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>action_queue<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>append<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>
        Action<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span> entity <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>entity<span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span>
                event  <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> <span class="token string" data-v-8488c362 data-v-8488c362>'try_move'</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span>
                data   <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> <span class="token punctuation" data-v-8488c362 data-v-8488c362>{</span><span class="token string" data-v-8488c362 data-v-8488c362>'target'</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span> <span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>target_x<span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> target_y<span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>}</span> <span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span>
</code></pre></div>
<p data-v-8488c362 data-v-8488c362>The <code data-v-8488c362 data-v-8488c362>PlayerManager</code> has an <code data-v-8488c362 data-v-8488c362>action_queue</code> attribute which is a <code data-v-8488c362 data-v-8488c362>collections.deque</code> instance. Each cycle of the game engine, if this queue has anything in it, we call a method <code data-v-8488c362 data-v-8488c362>get_next_action</code> which in turn calls <code data-v-8488c362 data-v-8488c362>self.action_queue.popleft()</code>. We return this to the <code data-v-8488c362 data-v-8488c362>ActionSystem</code> which calls <code data-v-8488c362 data-v-8488c362>Action.act</code>. So let's see how that works before proceeding with the remaining logic here in our <code data-v-8488c362 data-v-8488c362>move</code> method.</p>
<h3 id="action-and-actionsystem" data-v-8488c362 data-v-8488c362><a href="#action-and-actionsystem" aria-hidden="true" tabindex="-1" data-v-8488c362 data-v-8488c362><span class="icon icon-link" data-v-8488c362 data-v-8488c362></span></a>Action and ActionSystem</h3>
<p data-v-8488c362 data-v-8488c362>When we enqueued our <code data-v-8488c362 data-v-8488c362>Action</code>, we passed in a bunch of information that we'll need for resolving the actual action logic.</p>
<div class="nuxt-content-highlight" data-v-8488c362 data-v-8488c362><pre class="language-python line-numbers" data-v-8488c362 data-v-8488c362><code data-v-8488c362 data-v-8488c362><span class="token decorator annotation punctuation" data-v-8488c362 data-v-8488c362>@dataclass</span>
<span class="token keyword" data-v-8488c362 data-v-8488c362>class</span> <span class="token class-name" data-v-8488c362 data-v-8488c362>Action</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
    entity<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span> Entity
    event<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span> <span class="token builtin" data-v-8488c362 data-v-8488c362>str</span>
    data<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span> Dict<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token builtin" data-v-8488c362 data-v-8488c362>str</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> Any<span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span>
</code></pre></div>
<p data-v-8488c362 data-v-8488c362>In the <code data-v-8488c362 data-v-8488c362>ActionSystem</code>, we call the <code data-v-8488c362 data-v-8488c362>Action.act</code> method to execute the actual logic of the action.</p>
<div class="nuxt-content-highlight" data-v-8488c362 data-v-8488c362><pre class="language-python line-numbers" data-v-8488c362 data-v-8488c362><code data-v-8488c362 data-v-8488c362><span class="token keyword" data-v-8488c362 data-v-8488c362>class</span> <span class="token class-name" data-v-8488c362 data-v-8488c362>ActionSystem</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>AbstractSystem<span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
    <span class="token comment" data-v-8488c362 data-v-8488c362>#...</span>
    <span class="token keyword" data-v-8488c362 data-v-8488c362>def</span> <span class="token function" data-v-8488c362 data-v-8488c362>update</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>self<span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span> <span class="token operator" data-v-8488c362 data-v-8488c362>-</span><span class="token operator" data-v-8488c362 data-v-8488c362>></span> <span class="token builtin" data-v-8488c362 data-v-8488c362>bool</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
        entities <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>_query<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>result
        entities <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> deque<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span><span class="token builtin" data-v-8488c362 data-v-8488c362>sorted</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>entities<span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> key<span class="token operator" data-v-8488c362 data-v-8488c362>=</span><span class="token keyword" data-v-8488c362 data-v-8488c362>lambda</span> e<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span> e<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token string" data-v-8488c362 data-v-8488c362>'Actor'</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span>
        entity <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> entities<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>popleft<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span>
        <span class="token comment" data-v-8488c362 data-v-8488c362># ...</span>
        <span class="token keyword" data-v-8488c362 data-v-8488c362>while</span> entity <span class="token keyword" data-v-8488c362 data-v-8488c362>and</span> entity<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token string" data-v-8488c362 data-v-8488c362>'Actor'</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>has_energy<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
            <span class="token keyword" data-v-8488c362 data-v-8488c362>if</span> entity<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>has<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span><span class="token string" data-v-8488c362 data-v-8488c362>'IsPlayer'</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
                <span class="token keyword" data-v-8488c362 data-v-8488c362>try</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
                    action <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>game<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>player<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>get_next_action<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span>
                    <span class="token keyword" data-v-8488c362 data-v-8488c362>if</span> action<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
                        action<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>act<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span>
                        <span class="token keyword" data-v-8488c362 data-v-8488c362>return</span> <span class="token boolean" data-v-8488c362 data-v-8488c362>True</span>
                    <span class="token keyword" data-v-8488c362 data-v-8488c362>continue</span>
                <span class="token keyword" data-v-8488c362 data-v-8488c362>except</span> IndexError<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
                    <span class="token keyword" data-v-8488c362 data-v-8488c362>return</span> <span class="token boolean" data-v-8488c362 data-v-8488c362>False</span>
    <span class="token comment" data-v-8488c362 data-v-8488c362>#...</span>
</code></pre></div>
<p data-v-8488c362 data-v-8488c362>The <code data-v-8488c362 data-v-8488c362>_query</code> attribute holds references to all of the entities in the game that have an <code data-v-8488c362 data-v-8488c362>Actor</code> component.<sup id="fnref-2" data-v-8488c362 data-v-8488c362><a href="#fn-2" class="footnote-ref" data-v-8488c362 data-v-8488c362>2</a></sup> We sort our entities by their <code data-v-8488c362 data-v-8488c362>Actor</code> component (which sorts them by energy - more on that later). If the current entity is the player, get the next player action and run its <code data-v-8488c362 data-v-8488c362>act</code> method - so let's look at what that entails.</p>
<div class="nuxt-content-highlight" data-v-8488c362 data-v-8488c362><pre class="language-python line-numbers" data-v-8488c362 data-v-8488c362><code data-v-8488c362 data-v-8488c362>    <span class="token comment" data-v-8488c362 data-v-8488c362># in Action</span>
    <span class="token keyword" data-v-8488c362 data-v-8488c362>def</span> <span class="token function" data-v-8488c362 data-v-8488c362>act</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>self<span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span> <span class="token operator" data-v-8488c362 data-v-8488c362>-</span><span class="token operator" data-v-8488c362 data-v-8488c362>></span> <span class="token boolean" data-v-8488c362 data-v-8488c362>None</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
        <span class="token keyword" data-v-8488c362 data-v-8488c362>return</span> self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>entity<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>fire_event<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>event<span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>data<span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span>
</code></pre></div>
<p data-v-8488c362 data-v-8488c362>Alright, so that's straightforward. We're using the ECS to make an <code data-v-8488c362 data-v-8488c362>EntityEvent</code>, passing in our event data that we set up in the <code data-v-8488c362 data-v-8488c362>PlayerManager</code>:</p>
<div class="nuxt-content-highlight" data-v-8488c362 data-v-8488c362><pre class="language-python line-numbers" data-v-8488c362 data-v-8488c362><code data-v-8488c362 data-v-8488c362>    <span class="token keyword" data-v-8488c362 data-v-8488c362>def</span> <span class="token function" data-v-8488c362 data-v-8488c362>act</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>self<span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span> <span class="token operator" data-v-8488c362 data-v-8488c362>-</span><span class="token operator" data-v-8488c362 data-v-8488c362>></span> <span class="token boolean" data-v-8488c362 data-v-8488c362>None</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
        <span class="token keyword" data-v-8488c362 data-v-8488c362>return</span> self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>entity<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>fire_event<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span><span class="token string" data-v-8488c362 data-v-8488c362>'try_move'</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span>
                                      <span class="token punctuation" data-v-8488c362 data-v-8488c362>{</span><span class="token string" data-v-8488c362 data-v-8488c362>'target'</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span> <span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>target_x<span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> target_y<span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>}</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span>
</code></pre></div>
<p data-v-8488c362 data-v-8488c362>The <code data-v-8488c362 data-v-8488c362>fire_event</code> method broadcasts the event <code data-v-8488c362 data-v-8488c362>try_move</code> with data <code data-v-8488c362 data-v-8488c362>{'target': (..., ...)}</code> to every component attached to the player entity. To be usable, at least one component better implement a method <code data-v-8488c362 data-v-8488c362>on_try_move</code> for the ECS to do something with. Well, it so happens that our player does have such a component:</p>
<div class="nuxt-content-highlight" data-v-8488c362 data-v-8488c362><pre class="language-python line-numbers" data-v-8488c362 data-v-8488c362><code data-v-8488c362 data-v-8488c362><span class="token keyword" data-v-8488c362 data-v-8488c362>class</span> <span class="token class-name" data-v-8488c362 data-v-8488c362>Legs</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>BodyPart<span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
    <span class="token comment" data-v-8488c362 data-v-8488c362>#...</span>
    <span class="token keyword" data-v-8488c362 data-v-8488c362>def</span> <span class="token function" data-v-8488c362 data-v-8488c362>on_try_move</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>self<span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> evt<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span> EntityEvent<span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span> <span class="token operator" data-v-8488c362 data-v-8488c362>-</span><span class="token operator" data-v-8488c362 data-v-8488c362>></span> <span class="token boolean" data-v-8488c362 data-v-8488c362>None</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
        self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>update_position<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span><span class="token operator" data-v-8488c362 data-v-8488c362>*</span>evt<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>data<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token string" data-v-8488c362 data-v-8488c362>'target'</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span>
        evt<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>handle<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span>

    <span class="token keyword" data-v-8488c362 data-v-8488c362>def</span> <span class="token function" data-v-8488c362 data-v-8488c362>update_position</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>self<span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> x<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span> <span class="token builtin" data-v-8488c362 data-v-8488c362>int</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> y<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span> <span class="token builtin" data-v-8488c362 data-v-8488c362>int</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span> <span class="token operator" data-v-8488c362 data-v-8488c362>-</span><span class="token operator" data-v-8488c362 data-v-8488c362>></span> <span class="token boolean" data-v-8488c362 data-v-8488c362>None</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
        self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>entity<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token string" data-v-8488c362 data-v-8488c362>'Position'</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>x <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> x
        self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>entity<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token string" data-v-8488c362 data-v-8488c362>'Position'</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>y <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> y
</code></pre></div>
<p data-v-8488c362 data-v-8488c362>The end result is that the actual position of the entity changes on the next cycle of the <code data-v-8488c362 data-v-8488c362>PhysicsSystem</code>, which queries for entities with <code data-v-8488c362 data-v-8488c362>Position</code> and updates them accordingly.</p>
<h2 id="interim-comments" data-v-8488c362 data-v-8488c362><a href="#interim-comments" aria-hidden="true" tabindex="-1" data-v-8488c362 data-v-8488c362><span class="icon icon-link" data-v-8488c362 data-v-8488c362></span></a>Interim Comments</h2>
<p data-v-8488c362 data-v-8488c362>Alright, so that was a lot to unpack. The basic workflow, however, is fairly straightforward.</p>
<ol data-v-8488c362 data-v-8488c362>
<li data-v-8488c362 data-v-8488c362>Get input from the keyboard.</li>
<li data-v-8488c362 data-v-8488c362>Look up an appropriate method or tuple.</li>
<li data-v-8488c362 data-v-8488c362>Fire the method on the current Screen or pass a tuple to a method.</li>
<li data-v-8488c362 data-v-8488c362>Create an <code data-v-8488c362 data-v-8488c362>Action</code> with, at minimum, an event name (a string) and some concrete data (a dict).</li>
<li data-v-8488c362 data-v-8488c362>Enqueue the action.</li>
<li data-v-8488c362 data-v-8488c362>Fire the action's event, broadcasting it to the entity's component set.</li>
<li data-v-8488c362 data-v-8488c362>On detecting an event, grab the event data and do some work with it.</li>
</ol>
<p data-v-8488c362 data-v-8488c362>Now, this is the simplest case. However, there is more that happens in the <code data-v-8488c362 data-v-8488c362>PlayerManager</code>. Recall that we just created an action without regard for other world entities. What if we want to check for obstacles, or do something like see if we're running into an interactable? Well... then things get just a tad more complex.</p>
<p data-v-8488c362 data-v-8488c362>This is getting to be a bit long, so I think I'll call this good here and take it as an overview of the base case. In the second part, I'll break down the more advanced case of trying to check for interactables.</p>
<div class="footnotes" data-v-8488c362 data-v-8488c362>
<hr data-v-8488c362 data-v-8488c362>
<ol data-v-8488c362 data-v-8488c362>
<li id="fn-1" data-v-8488c362 data-v-8488c362>This is a pattern that I first came across while studying <a href="https://github.com/HexDecimal/roguelike-tutorial" rel="nofollow noopener noreferrer" target="_blank" data-v-8488c362 data-v-8488c362>HexDecimal's tcod-based tutorial project</a>. I've since implemented it in most of my projects, as it's so intuitive.<a href="#fnref-1" class="footnote-backref" data-v-8488c362 data-v-8488c362></a></li>
<li id="fn-2" data-v-8488c362 data-v-8488c362>See the documentation for <a href="https://github.com/krummja/ECStremity" rel="nofollow noopener noreferrer" target="_blank" data-v-8488c362 data-v-8488c362>ECStremity</a> to see how this works in more detail.<a href="#fnref-2" class="footnote-backref" data-v-8488c362 data-v-8488c362></a></li>
</ol>
</div></div></div></div></div></div> <div class="colorpop rounded-b"></div> <div class="my-6" data-v-2995466f><span class="copyright" data-v-2995466f> 2019-2021 Jonathan Crum</span></div></div></div></div><script defer src="/_nuxt/static/1615344676/devlog/2021-03-07-anathema/state.js"></script><script src="/_nuxt/ac44da6.js" defer></script><script src="/_nuxt/4b85684.js" defer></script><script src="/_nuxt/d971605.js" defer></script><script src="/_nuxt/d026428.js" defer></script><script src="/_nuxt/7f5f87e.js" defer></script><script src="/_nuxt/52d3781.js" defer></script>
  </body>
</html>
