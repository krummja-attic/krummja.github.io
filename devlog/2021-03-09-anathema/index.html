<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>simulacrum</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content=""><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css2?family=PT+Serif&display=swap"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css2?family=PT+Serif:wght@700&display=swap"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Caveat&display=swap"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Pangolin&display=swap"><script data-n-head="ssr" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_HTML"></script><script data-n-head="ssr" src="https://d3js.org/d3.v6.min.js"></script><script data-n-head="ssr" src="//unpkg.com/graphre/dist/graphre.js"></script><script data-n-head="ssr" src="//unpkg.com/nomnoml/dist/nomnoml.js"></script><link rel="preload" href="/_nuxt/10c2450.js" as="script"><link rel="preload" href="/_nuxt/4ca9ec1.js" as="script"><link rel="preload" href="/_nuxt/b4dab43.js" as="script"><link rel="preload" href="/_nuxt/2c5d41a.js" as="script"><link rel="preload" href="/_nuxt/52c57d5.js" as="script"><link rel="preload" href="/_nuxt/4bbc75c.js" as="script"><style data-vue-ssr-id="0211d3d2:0 2e714118:0 517a8dd7:0 fa7ff0ca:0 5c346d62:0 5c346d62:1 5c346d62:2 5c346d62:3 2c61fa44:0 5e9e604d:0 b23bd908:0 a4d88c8c:0 1a1f8051:0 7480e6b4:0">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,"Segoe UI","Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5}*,:after,:before{box-sizing:border-box;border:0 solid #e2e8f0}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#a0aec0}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#a0aec0}input::placeholder,textarea::placeholder{color:#a0aec0}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit}code,kbd,pre,samp{font-family:Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}.container{width:100%}@media (min-width:320px){.container{max-width:320px}}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}@media (min-width:1351px){.container{max-width:1351px}}.bg-transparent{background-color:transparent}.hover\:border-purple-700:hover{--border-opacity:1;border-color:#6b46c1;border-color:rgba(107,70,193,var(--border-opacity))}.rounded{border-radius:.25rem}.rounded-full{border-radius:9999px}.rounded-b{border-bottom-right-radius:.25rem;border-bottom-left-radius:.25rem}.border{border-width:1px}.block{display:block}.flex{display:flex}.table{display:table}.flex-row{flex-direction:row}.flex-row-reverse{flex-direction:row-reverse}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.place-self-auto{align-self:auto;justify-self:auto;place-self:auto}.justify-between{justify-content:space-between}.font-medium{font-weight:500}.font-bold{font-weight:700}.h-48{height:12rem}.text-sm{font-size:.875rem}.text-base{font-size:1rem}.text-lg{font-size:1.125rem}.text-2xl{font-size:1.5rem}.text-3xl{font-size:1.875rem}.text-4xl{font-size:2.25rem}.my-6{margin-top:1.5rem;margin-bottom:1.5rem}.my-10{margin-top:2.5rem;margin-bottom:2.5rem}.mx-auto{margin-left:auto;margin-right:auto}.mt-2{margin-top:.5rem}.mb-2{margin-bottom:.5rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.mb-10{margin-bottom:2.5rem}.object-cover{-o-object-fit:cover;object-fit:cover}.p-5{padding:1.25rem}.p-6{padding:1.5rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-5{padding-left:1.25rem;padding-right:1.25rem}.pr-6{padding-right:1.5rem}.static{position:static}.sticky{position:-webkit-sticky;position:sticky}.shadow-sm{box-shadow:0 1px 2px 0 rgba(0,0,0,.05)}.shadow-md{box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)}.shadow-lg{box-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -2px rgba(0,0,0,.05)}.hover\:shadow-md:hover{box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)}.text-center{text-align:center}.text-gray-600{--text-opacity:1;color:#718096;color:rgba(113,128,150,var(--text-opacity))}.text-purple-900{--text-opacity:1;color:#44337a;color:rgba(68,51,122,var(--text-opacity))}.hover\:text-gray-900:hover{--text-opacity:1;color:#1a202c;color:rgba(26,32,44,var(--text-opacity))}.hover\:text-purple-600:hover{--text-opacity:1;color:#805ad5;color:rgba(128,90,213,var(--text-opacity))}.italic{font-style:italic}.tracking-wide{letter-spacing:.025em}.tracking-wider{letter-spacing:.05em}.invisible{visibility:hidden}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.w-16{width:4rem}.w-1\/2{width:50%}.w-full{width:100%}.transform{--transform-translate-x:0;--transform-translate-y:0;--transform-rotate:0;--transform-skew-x:0;--transform-skew-y:0;--transform-scale-x:1;--transform-scale-y:1;transform:translateX(var(--transform-translate-x)) translateY(var(--transform-translate-y)) rotate(var(--transform-rotate)) skewX(var(--transform-skew-x)) skewY(var(--transform-skew-y)) scaleX(var(--transform-scale-x)) scaleY(var(--transform-scale-y))}.transition-colors{transition-property:background-color,border-color,color,fill,stroke}.transition-shadow{transition-property:box-shadow}.ease-linear{transition-timing-function:linear}.ease-in-out{transition-timing-function:cubic-bezier(.4,0,.2,1)}.duration-75{transition-duration:75ms}.duration-150{transition-duration:.15s}.duration-300{transition-duration:.3s}@-webkit-keyframes spin{to{transform:rotate(1turn)}}@keyframes spin{to{transform:rotate(1turn)}}@-webkit-keyframes ping{75%,to{transform:scale(2);opacity:0}}@keyframes ping{75%,to{transform:scale(2);opacity:0}}@-webkit-keyframes pulse{50%{opacity:.5}}@keyframes pulse{50%{opacity:.5}}@-webkit-keyframes bounce{0%,to{transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1)}}@keyframes bounce{0%,to{transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1)}}@media (min-width:320px){.xs\:container{width:100%}}@media (min-width:320px) and (min-width:320px){.xs\:container{max-width:320px}}@media (min-width:320px) and (min-width:640px){.xs\:container{max-width:640px}}@media (min-width:320px) and (min-width:768px){.xs\:container{max-width:768px}}@media (min-width:320px) and (min-width:1024px){.xs\:container{max-width:1024px}}@media (min-width:320px) and (min-width:1280px){.xs\:container{max-width:1280px}}@media (min-width:320px) and (min-width:1351px){.xs\:container{max-width:1351px}}@media (min-width:320px){.xs\:flex-col{flex-direction:column}.xs\:text-sm{font-size:.875rem}.xs\:text-xl{font-size:1.25rem}.xs\:text-2xl{font-size:1.5rem}.xs\:text-3xl{font-size:1.875rem}.xs\:my-2{margin-top:.5rem;margin-bottom:.5rem}.xs\:my-4{margin-top:1rem;margin-bottom:1rem}.xs\:mb-6{margin-bottom:1.5rem}.xs\:w-24{width:6rem}.xs\:w-full{width:100%}}@media (min-width:640px){.sm\:container{width:100%}}@media (min-width:640px) and (min-width:320px){.sm\:container{max-width:320px}}@media (min-width:640px) and (min-width:640px){.sm\:container{max-width:640px}}@media (min-width:640px) and (min-width:768px){.sm\:container{max-width:768px}}@media (min-width:640px) and (min-width:1024px){.sm\:container{max-width:1024px}}@media (min-width:640px) and (min-width:1280px){.sm\:container{max-width:1280px}}@media (min-width:640px) and (min-width:1351px){.sm\:container{max-width:1351px}}@media (min-width:640px){.sm\:flex-col{flex-direction:column}.sm\:text-sm{font-size:.875rem}.sm\:mx-1{margin-left:.25rem;margin-right:.25rem}.sm\:mx-8{margin-left:2rem;margin-right:2rem}.sm\:w-24{width:6rem}.sm\:w-1\/2{width:50%}}@media (min-width:768px){.md\:container{width:100%}}@media (min-width:768px) and (min-width:320px){.md\:container{max-width:320px}}@media (min-width:768px) and (min-width:640px){.md\:container{max-width:640px}}@media (min-width:768px) and (min-width:768px){.md\:container{max-width:768px}}@media (min-width:768px) and (min-width:1024px){.md\:container{max-width:1024px}}@media (min-width:768px) and (min-width:1280px){.md\:container{max-width:1280px}}@media (min-width:768px) and (min-width:1351px){.md\:container{max-width:1351px}}@media (min-width:768px){.md\:flex-row{flex-direction:row}.md\:text-base{font-size:1rem}.md\:text-xl{font-size:1.25rem}.md\:text-2xl{font-size:1.5rem}.md\:text-3xl{font-size:1.875rem}.md\:text-5xl{font-size:3rem}.md\:my-8{margin-top:2rem;margin-bottom:2rem}.md\:mx-8{margin-left:2rem;margin-right:2rem}.md\:mx-16{margin-left:4rem;margin-right:4rem}.md\:mt-8{margin-top:2rem}.md\:mb-8{margin-bottom:2rem}.md\:mb-12{margin-bottom:3rem}.md\:w-32{width:8rem}.md\:w-1\/2{width:50%}.md\:w-1\/3{width:33.333333%}.md\:w-full{width:100%}}@media (min-width:1024px){.lg\:container{width:100%}}@media (min-width:1024px) and (min-width:320px){.lg\:container{max-width:320px}}@media (min-width:1024px) and (min-width:640px){.lg\:container{max-width:640px}}@media (min-width:1024px) and (min-width:768px){.lg\:container{max-width:768px}}@media (min-width:1024px) and (min-width:1024px){.lg\:container{max-width:1024px}}@media (min-width:1024px) and (min-width:1280px){.lg\:container{max-width:1280px}}@media (min-width:1024px) and (min-width:1351px){.lg\:container{max-width:1351px}}@media (min-width:1024px){.lg\:flex-row{flex-direction:row}.lg\:flex-col{flex-direction:column}.lg\:flex-1{flex:1 1 0%}.lg\:text-lg{font-size:1.125rem}.lg\:mx-16{margin-left:4rem;margin-right:4rem}.lg\:mx-32{margin-left:8rem;margin-right:8rem}.lg\:w-48{width:12rem}.lg\:w-1\/2{width:50%}}@media (min-width:1280px){.xl\:container{width:100%}}@media (min-width:1280px) and (min-width:320px){.xl\:container{max-width:320px}}@media (min-width:1280px) and (min-width:640px){.xl\:container{max-width:640px}}@media (min-width:1280px) and (min-width:768px){.xl\:container{max-width:768px}}@media (min-width:1280px) and (min-width:1024px){.xl\:container{max-width:1024px}}@media (min-width:1280px) and (min-width:1280px){.xl\:container{max-width:1280px}}@media (min-width:1280px) and (min-width:1351px){.xl\:container{max-width:1351px}}@media (min-width:1280px){.xl\:text-xl{font-size:1.25rem}.xl\:mx-24{margin-left:6rem;margin-right:6rem}.xl\:mx-64{margin-left:16rem;margin-right:16rem}.xl\:visible{visibility:visible}.xl\:w-0{width:0}.xl\:w-48{width:12rem}.xl\:w-1\/3{width:33.333333%}}@media (min-width:1351px){.xxlmin\:container{width:100%}}@media (min-width:1351px) and (min-width:320px){.xxlmin\:container{max-width:320px}}@media (min-width:1351px) and (min-width:640px){.xxlmin\:container{max-width:640px}}@media (min-width:1351px) and (min-width:768px){.xxlmin\:container{max-width:768px}}@media (min-width:1351px) and (min-width:1024px){.xxlmin\:container{max-width:1024px}}@media (min-width:1351px) and (min-width:1280px){.xxlmin\:container{max-width:1280px}}@media (min-width:1351px) and (min-width:1351px){.xxlmin\:container{max-width:1351px}}@media (min-width:1351px){.xxlmin\:w-1\/2{width:50%}}@media (max-width:1350px){.xxlmax\:container{width:100%}}@media (max-width:1350px) and (min-width:320px){.xxlmax\:container{max-width:320px}}@media (max-width:1350px) and (min-width:640px){.xxlmax\:container{max-width:640px}}@media (max-width:1350px) and (min-width:768px){.xxlmax\:container{max-width:768px}}@media (max-width:1350px) and (min-width:1024px){.xxlmax\:container{max-width:1024px}}@media (max-width:1350px) and (min-width:1280px){.xxlmax\:container{max-width:1280px}}@media (max-width:1350px) and (min-width:1351px){.xxlmax\:container{max-width:1351px}}@media (max-width:1350px){.xxlmax\:flex-col{flex-direction:column}.xxlmax\:w-full{width:100%}}code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,"Andale Mono","Ubuntu Mono",monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}html{font-family:"PT Serif",Georgia,Times,"Times New Roman",serif;background-color:#ede5d9;color:#2d2d2d;font-size:16px;word-spacing:1px;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;box-sizing:border-box}*,:after,:before{box-sizing:border-box;margin:0}.container{height:100%;text-align:center}.content-wrapper{height:100%;padding:40px 30px;background-color:#f7f3ef}.colorpop{height:20px;width:100%;bottom:20px;background-color:rgba(75,60,90,.8)}.colorpop,.nuxt-content{position:relative}.nuxt-content a{color:#4b3c5a;text-decoration:none;font-weight:600;box-shadow:inset 0 -.225rem 0 0 #f7f3ef,inset 0 -.475rem 0 0 rgba(115,90,140,.25)}.nuxt-content h1,.nuxt-content h2{color:rgba(75,60,90,.8);font-weight:700;font-size:28px}.nuxt-content h2{padding-top:30px}.nuxt-content h3{color:rgba(75,60,90,.8);padding-top:30px;font-weight:700;font-size:22px}.nuxt-content h4{color:rgba(75,60,90,.8);margin-top:30px;font-style:italic;font-size:20px}.nuxt-content p{margin:16px 0}.nuxt-content ol{margin:32px 0;padding:0 60px;list-style-type:decimal}.nuxt-content ul{margin:32px 0;padding:0 60px;list-style-type:circle}.nuxt-content li{padding-left:10px}.nuxt-content pre{margin:40px 0;border-radius:8px;box-shadow:inset 0 0 10px rgba(0,0,0,.1);background:#ede5d9}.nuxt-content pre code{font-size:12pt;border-radius:0;padding:0;box-shadow:none;background:0 0}.nuxt-content pre code span.token.operator{background:0 0}.nuxt-content .dropcap{color:#4b3c5a;float:left;font-size:75px;line-height:60px;padding-top:4px;padding-right:8px;padding-left:3px}.nuxt-content .footnotes{margin-top:150px}.nuxt-content .footnotes li{margin-top:8px}.nuxt-content .footnotes:before{content:"References";color:rgba(75,60,90,.8);font-weight:700;font-size:28px}.nuxt-content .footnote-ref{color:#4b3c5a}.nuxt-content .footnote-backref{margin-left:6px;color:#4b3c5a}code{padding:0 5px;background:#ede5d9;border-radius:8px;box-shadow:inset 0 0 10px rgba(0,0,0,.1);font-size:12pt}.title[data-v-a84a9dec]{color:rgba(75,60,90,.8)}.logo[data-v-a84a9dec]{display:block;margin:24px auto 4px}.tab-primary[data-v-bec176d0]{font-weight:700;color:#5e5e5e;background-color:#f7f3ef}.tab-secondary[data-v-bec176d0]{font-weight:400;color:#5e5e5e;background-color:#c9c2b7}.tab-ternary[data-v-bec176d0]{font-weight:700;color:#5e5e5e;background-color:#f7f3ef}.tab[data-v-bec176d0]{padding-top:2px;width:120px;height:30px;border-radius:10px 10px 0 0;font-size:1rem}.container[data-v-8488c362]{height:100%}.log-header[data-v-8488c362]{text-align:center;width:100%}.log[data-v-8488c362]{text-align:justify}.log-title[data-v-8488c362]{color:rgba(75,60,90,.8)}.project-title a[data-v-8488c362]{color:#4b3c5a;text-decoration:none;font-weight:600;box-shadow:inset 0 -.2rem 0 0 #f7f3ef,inset 0 -.6rem 0 0 rgba(115,90,140,.25)}@media (min-width:320px){.nuxt-content code[data-v-8488c362],.nuxt-content pre code[data-v-8488c362]{font-size:.75rem}}@media (min-width:640px){.nuxt-content code[data-v-8488c362],.nuxt-content pre code[data-v-8488c362]{font-size:.875rem}}@media (min-width:768px){.nuxt-content code[data-v-8488c362],.nuxt-content pre code[data-v-8488c362]{font-size:1rem}}@media (min-width:1024px){.nuxt-content code[data-v-8488c362],.nuxt-content pre code[data-v-8488c362]{font-size:1rem}}.wrapper[data-v-7c884151]{position:-webkit-sticky;position:sticky;top:30px}.toc[data-v-7c884151]{position:absolute;text-align:left;left:-40px;padding:20px;background-color:#f7f3ef}.toc2[data-v-7c884151]{font-weight:700}.toc3[data-v-7c884151]{padding-left:10px}.wrapper[data-v-e5676080]{max-height:250px;font-family:Pangolin,cursive;font-weight:400;z-index:1;float:right;position:absolute;left:100%;padding:10px;margin-left:10px;color:#333;background-color:#ffeca9}@media screen and (min-width:1280px){.wrapper[data-v-e5676080]{min-width:250px}}@media screen and (min-width:1024px){.wrapper[data-v-e5676080]{width:0}}@media screen and (min-width:768px){.wrapper[data-v-e5676080]{width:0}}@media screen and (min-width:640px){.wrapper[data-v-e5676080]{width:0}}@media screen and (min-width:320px){.wrapper[data-v-e5676080]{width:0}}.sticky[data-v-e5676080]{width:auto}.sticky[data-v-e5676080]:after{content:"";display:block;padding-bottom:100%}.copyright[data-v-2995466f]{text-align:center;color:#909090}</style><link rel="preload" href="/_nuxt/static/1615860469/devlog/2021-03-09-anathema/state.js" as="script"><link rel="preload" href="/_nuxt/static/1615860469/devlog/2021-03-09-anathema/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1615860469/manifest.js" as="script">
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div class="container mx-auto bg-transparent"><div data-v-a84a9dec><a href="/" class="nuxt-link-active" data-v-a84a9dec><div data-v-a84a9dec><img src="/logo.svg" class="logo w-16 xs:w-24 sm:w-24 md:w-32 lg:w-48 xl:w-48" data-v-a84a9dec></div> <h1 class="title xs:text-3xl md:text-5xl font-bold tracking-wide" data-v-a84a9dec>
        Simula<span style="color:#4b3c5a" data-v-a84a9dec>crum</span></h1> <h2 class="title md:mb-8 xs:text-xl md:text-xl" data-v-a84a9dec>Jonathan Crum's digital garden</h2></a></div> <div class="flex flex-row" data-v-bec176d0><a href="/" class="tab tab-primary tab-secondary" data-v-bec176d0>Home</a> <a href="/blogIndex" class="tab tab-secondary" data-v-bec176d0>Blog</a> <a href="/notebookIndex" class="tab tab-secondary" data-v-bec176d0>Notebook</a> <a href="/devlogIndex" class="tab tab-secondary tab-ternary" data-v-bec176d0>Devlog</a></div> <div class="content-wrapper shadow-lg rounded"><div class="container" data-v-8488c362><div class="wrapper invisible xl:visible" data-v-7c884151 data-v-8488c362><ul class="toc shadow-lg" data-v-7c884151><li class="toc2" data-v-7c884151><a href="/devlog/2021-03-09-anathema#advanced-case" class="transition-colors duration-75 text-base mb-2 block text-gray-600 hover:text-gray-900" data-v-7c884151>Advanced Case</a></li><li class="toc3" data-v-7c884151><a href="/devlog/2021-03-09-anathema#area-and-physicssystem" class="transition-colors duration-75 text-base mb-2 block text-gray-600 hover:text-gray-900" data-v-7c884151>Area and PhysicsSystem</a></li><li class="toc3" data-v-7c884151><a href="/devlog/2021-03-09-anathema#actor" class="transition-colors duration-75 text-base mb-2 block text-gray-600 hover:text-gray-900" data-v-7c884151>Actor</a></li></ul></div> <div class="log w-full px-2 xs:mb-6 md:mb-12" data-v-8488c362><div class="log-header" data-v-8488c362><h1 class="log-title tracking-wide font-bold xs:text-2xl md:text-3xl xs:my-4 md:mt-8 mb-2" data-v-8488c362>
        refactor/components
      </h1> <h2 class="project-title tracking-wide font-bold xs:text-xl md:text-2xl" data-v-8488c362><a href="https://github.com/krummja/Anathema" data-v-8488c362>Anathema</a></h2> <div class="xs:my-2 md:my-8" data-v-8488c362>
        March 9, 2021
      </div></div> <div class="log-body xs:text-sm sm:text-sm md:text-base lg:text-lg xl:text-xl sm:mx-1 md:mx-16 lg:mx-32 xl:mx-64" data-v-8488c362><div class="nuxt-content" data-v-8488c362 data-v-8488c362><p data-v-8488c362 data-v-8488c362>This is continued from <a href="https://www.simulacrum.space/devlog/2021-03-07-anathema" rel="nofollow noopener noreferrer" target="_blank" data-v-8488c362 data-v-8488c362>Part 1</a>.</p>
<h2 id="advanced-case" data-v-8488c362 data-v-8488c362><a href="#advanced-case" aria-hidden="true" tabindex="-1" data-v-8488c362 data-v-8488c362><span class="icon icon-link" data-v-8488c362 data-v-8488c362></span></a>Advanced Case</h2>
<p data-v-8488c362 data-v-8488c362>Recall that the <code data-v-8488c362 data-v-8488c362>PlayerManager</code> is where we routed our position offset via <code data-v-8488c362 data-v-8488c362>cmd_move</code> on the active Screen. We calculated the new position, then created an <code data-v-8488c362 data-v-8488c362>Action</code> instance with that target position as data, with an event <code data-v-8488c362 data-v-8488c362>'try_move'</code> to fire on the player's entity. To account for collisions, we need to intervene in the <code data-v-8488c362 data-v-8488c362>PlayerManager</code> and check the target position for entities with a <code data-v-8488c362 data-v-8488c362>Blocker</code> component.</p>
<div class="nuxt-content-highlight" data-v-8488c362 data-v-8488c362><pre class="language-python line-numbers" data-v-8488c362 data-v-8488c362><code data-v-8488c362 data-v-8488c362>    <span class="token comment" data-v-8488c362 data-v-8488c362># ...</span>
    <span class="token keyword" data-v-8488c362 data-v-8488c362>def</span> <span class="token function" data-v-8488c362 data-v-8488c362>move</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>self<span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> direction<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span> Tuple<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token builtin" data-v-8488c362 data-v-8488c362>int</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> <span class="token builtin" data-v-8488c362 data-v-8488c362>int</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span> <span class="token operator" data-v-8488c362 data-v-8488c362>-</span><span class="token operator" data-v-8488c362 data-v-8488c362>></span> <span class="token boolean" data-v-8488c362 data-v-8488c362>None</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
        target_x <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>position<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token number" data-v-8488c362 data-v-8488c362>0</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span> <span class="token operator" data-v-8488c362 data-v-8488c362>+</span> direction<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token number" data-v-8488c362 data-v-8488c362>0</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span>
        target_y <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>position<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token number" data-v-8488c362 data-v-8488c362>1</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span> <span class="token operator" data-v-8488c362 data-v-8488c362>+</span> direction<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token number" data-v-8488c362 data-v-8488c362>1</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span>

        <span class="token keyword" data-v-8488c362 data-v-8488c362>if</span> self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>game<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>world<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>current_area<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>is_blocked<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>target_x<span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> target_y<span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
            <span class="token comment" data-v-8488c362 data-v-8488c362># ...</span>
    <span class="token comment" data-v-8488c362 data-v-8488c362># ...</span>
</code></pre></div>
<h3 id="area-and-physicssystem" data-v-8488c362 data-v-8488c362><a href="#area-and-physicssystem" aria-hidden="true" tabindex="-1" data-v-8488c362 data-v-8488c362><span class="icon icon-link" data-v-8488c362 data-v-8488c362></span></a>Area and PhysicsSystem</h3>
<p data-v-8488c362 data-v-8488c362>Over in the <code data-v-8488c362 data-v-8488c362>Area</code> class, we want to route our target coordinates over to the game's <code data-v-8488c362 data-v-8488c362>PhysicsSystem</code>, where we'll query the ECS for <code data-v-8488c362 data-v-8488c362>Blockers</code>:</p>
<div class="nuxt-content-highlight" data-v-8488c362 data-v-8488c362><pre class="language-python line-numbers" data-v-8488c362 data-v-8488c362><code data-v-8488c362 data-v-8488c362><span class="token keyword" data-v-8488c362 data-v-8488c362>class</span> <span class="token class-name" data-v-8488c362 data-v-8488c362>Area</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
    <span class="token comment" data-v-8488c362 data-v-8488c362># ...</span>
    <span class="token keyword" data-v-8488c362 data-v-8488c362>def</span> <span class="token function" data-v-8488c362 data-v-8488c362>is_blocked</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>self<span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> x<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span> <span class="token builtin" data-v-8488c362 data-v-8488c362>int</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> y<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span> <span class="token builtin" data-v-8488c362 data-v-8488c362>int</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span> <span class="token operator" data-v-8488c362 data-v-8488c362>-</span><span class="token operator" data-v-8488c362 data-v-8488c362>></span> <span class="token builtin" data-v-8488c362 data-v-8488c362>bool</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
        <span class="token comment" data-v-8488c362 data-v-8488c362>#...</span>
        <span class="token keyword" data-v-8488c362 data-v-8488c362>if</span> <span class="token keyword" data-v-8488c362 data-v-8488c362>not</span> self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>region<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>world<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>game<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>physics_system<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>passable<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span>x<span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span>y<span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
            <span class="token keyword" data-v-8488c362 data-v-8488c362>return</span> <span class="token boolean" data-v-8488c362 data-v-8488c362>True</span>
        <span class="token keyword" data-v-8488c362 data-v-8488c362>else</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
            <span class="token keyword" data-v-8488c362 data-v-8488c362>return</span> <span class="token boolean" data-v-8488c362 data-v-8488c362>False</span>
</code></pre></div>
<p data-v-8488c362 data-v-8488c362>The <code data-v-8488c362 data-v-8488c362>PhysicsSystem</code> maintains a boolean array that stores all of our passable coordinates. It updates this array on each engine cycle by querying for entities with a <code data-v-8488c362 data-v-8488c362>Blocker</code> component. For each of those entities, it sets that entity's position to impassable, and then updates the array for passable positions (necessary to actually update the array data).</p>
<div class="nuxt-content-highlight" data-v-8488c362 data-v-8488c362><pre class="language-python line-numbers" data-v-8488c362 data-v-8488c362><code data-v-8488c362 data-v-8488c362><span class="token keyword" data-v-8488c362 data-v-8488c362>class</span> <span class="token class-name" data-v-8488c362 data-v-8488c362>PhysicsSystem</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>AbstractSystem<span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>

    <span class="token keyword" data-v-8488c362 data-v-8488c362>def</span> <span class="token function" data-v-8488c362 data-v-8488c362>__init__</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>self<span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> game<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span> Game<span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span> <span class="token operator" data-v-8488c362 data-v-8488c362>-</span><span class="token operator" data-v-8488c362 data-v-8488c362>></span> <span class="token boolean" data-v-8488c362 data-v-8488c362>None</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
        <span class="token comment" data-v-8488c362 data-v-8488c362># ...</span>
        self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>_blockers <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>ecs<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>create_query<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>all_of<span class="token operator" data-v-8488c362 data-v-8488c362>=</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span> <span class="token string" data-v-8488c362 data-v-8488c362>'Blocker'</span> <span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span>
        <span class="token comment" data-v-8488c362 data-v-8488c362># ...</span>
        self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>passable <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> np<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>ones<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span><span class="token number" data-v-8488c362 data-v-8488c362>64</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> <span class="token number" data-v-8488c362 data-v-8488c362>64</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> dtype<span class="token operator" data-v-8488c362 data-v-8488c362>=</span>np<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span><span class="token builtin" data-v-8488c362 data-v-8488c362>bool</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> order<span class="token operator" data-v-8488c362 data-v-8488c362>=</span><span class="token string" data-v-8488c362 data-v-8488c362>"F"</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span>

    <span class="token comment" data-v-8488c362 data-v-8488c362># ...</span>
    <span class="token keyword" data-v-8488c362 data-v-8488c362>def</span> <span class="token function" data-v-8488c362 data-v-8488c362>update</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>self<span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> dt<span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span> <span class="token operator" data-v-8488c362 data-v-8488c362>-</span><span class="token operator" data-v-8488c362 data-v-8488c362>></span> <span class="token boolean" data-v-8488c362 data-v-8488c362>None</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
        <span class="token keyword" data-v-8488c362 data-v-8488c362>for</span> target <span class="token keyword" data-v-8488c362 data-v-8488c362>in</span> self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>_blockers<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>result<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
            x<span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> y <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> target<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token string" data-v-8488c362 data-v-8488c362>'Position'</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span>
            <span class="token keyword" data-v-8488c362 data-v-8488c362>if</span> target<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>has<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span><span class="token string" data-v-8488c362 data-v-8488c362>'Blocker'</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
                self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>passable<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span>x<span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span>y<span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span> <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> <span class="token boolean" data-v-8488c362 data-v-8488c362>False</span>
            <span class="token keyword" data-v-8488c362 data-v-8488c362>else</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
                self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>passable<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span>x<span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span>y<span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span> <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> <span class="token boolean" data-v-8488c362 data-v-8488c362>True</span>
</code></pre></div>
<p data-v-8488c362 data-v-8488c362>With this data, we can now handle the case that the target position is blocked.</p>
<div class="nuxt-content-highlight" data-v-8488c362 data-v-8488c362><pre class="language-python line-numbers" data-v-8488c362 data-v-8488c362><code data-v-8488c362 data-v-8488c362>    <span class="token comment" data-v-8488c362 data-v-8488c362># ...</span>
    <span class="token keyword" data-v-8488c362 data-v-8488c362>def</span> <span class="token function" data-v-8488c362 data-v-8488c362>move</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>self<span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> direction<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span> Tuple<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token builtin" data-v-8488c362 data-v-8488c362>int</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> <span class="token builtin" data-v-8488c362 data-v-8488c362>int</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span> <span class="token operator" data-v-8488c362 data-v-8488c362>-</span><span class="token operator" data-v-8488c362 data-v-8488c362>></span> <span class="token boolean" data-v-8488c362 data-v-8488c362>None</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
        target_x <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>position<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token number" data-v-8488c362 data-v-8488c362>0</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span> <span class="token operator" data-v-8488c362 data-v-8488c362>+</span> direction<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token number" data-v-8488c362 data-v-8488c362>0</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span>
        target_y <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>position<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token number" data-v-8488c362 data-v-8488c362>1</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span> <span class="token operator" data-v-8488c362 data-v-8488c362>+</span> direction<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token number" data-v-8488c362 data-v-8488c362>1</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span>

        <span class="token keyword" data-v-8488c362 data-v-8488c362>if</span> self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>game<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>world<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>current_area<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>is_blocked<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>target_x<span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> target_y<span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
            self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>game<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>log<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>report<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>Message<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span><span class="token string" data-v-8488c362 data-v-8488c362>"The way is blocked!"</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span>
        <span class="token keyword" data-v-8488c362 data-v-8488c362>else</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
            <span class="token comment" data-v-8488c362 data-v-8488c362># Action with event `'try_move'`.</span>
    <span class="token comment" data-v-8488c362 data-v-8488c362># ...</span>
</code></pre></div>
<p data-v-8488c362 data-v-8488c362>Alright, now we're cruisin' - at least, where we're supposed to be cruisin'. Now we can actually get to the case that I wanted to evaluate, which is interaction with other entities. For this, we need to do a similar to check to blockers, but instead we want to check for entities with an <code data-v-8488c362 data-v-8488c362>IsInteractable</code> component. To do this, we'll do a second check right after our blocker check, so that if we are blocked, we want to subsequently check if we can interact with the entity blocking our movement.</p>
<div id="0" class="wrapper shadow-md invisible xl:visible xl:w-0" style="transform:rotate(-5deg)" data-v-e5676080 data-v-8488c362><div class="sticky" data-v-e5676080>
Checking for interactables at the target position, then separately getting the interactable seems like it could be implemented more cleanly...
</div></div>
<div class="nuxt-content-highlight" data-v-8488c362 data-v-8488c362><pre class="language-python line-numbers" data-v-8488c362 data-v-8488c362><code data-v-8488c362 data-v-8488c362>    <span class="token comment" data-v-8488c362 data-v-8488c362># ...</span>
    <span class="token keyword" data-v-8488c362 data-v-8488c362>def</span> <span class="token function" data-v-8488c362 data-v-8488c362>move</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>self<span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> direction<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span> Tuple<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token builtin" data-v-8488c362 data-v-8488c362>int</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> <span class="token builtin" data-v-8488c362 data-v-8488c362>int</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span> <span class="token operator" data-v-8488c362 data-v-8488c362>-</span><span class="token operator" data-v-8488c362 data-v-8488c362>></span> <span class="token boolean" data-v-8488c362 data-v-8488c362>None</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
        target_x <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>position<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token number" data-v-8488c362 data-v-8488c362>0</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span> <span class="token operator" data-v-8488c362 data-v-8488c362>+</span> direction<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token number" data-v-8488c362 data-v-8488c362>0</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span>
        target_y <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>position<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token number" data-v-8488c362 data-v-8488c362>1</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span> <span class="token operator" data-v-8488c362 data-v-8488c362>+</span> direction<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token number" data-v-8488c362 data-v-8488c362>1</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span>

        <span class="token keyword" data-v-8488c362 data-v-8488c362>if</span> self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>game<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>world<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>current_area<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>is_blocked<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>target_x<span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> target_y<span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>

            <span class="token keyword" data-v-8488c362 data-v-8488c362>if</span> self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>game<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>world<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>current_area<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>is_interactable<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>target_x<span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> target_y<span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
                interactable <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>game<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>interaction_system<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>get<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>target_x<span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> target_y<span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span>

                self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>action_queue<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>append<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>
                    Action<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>entity <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>entity<span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span>
                           event  <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> <span class="token string" data-v-8488c362 data-v-8488c362>'try_get_interactions'</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span>
                           data   <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> <span class="token punctuation" data-v-8488c362 data-v-8488c362>{</span><span class="token string" data-v-8488c362 data-v-8488c362>'target'</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span> interactable<span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span>
                                     <span class="token string" data-v-8488c362 data-v-8488c362>'expect'</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span> <span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>}</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span>
            <span class="token keyword" data-v-8488c362 data-v-8488c362>else</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
                self<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>game<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>log<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>report<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>Message<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span><span class="token string" data-v-8488c362 data-v-8488c362>"The way is blocked!"</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span>
        <span class="token keyword" data-v-8488c362 data-v-8488c362>else</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
            <span class="token comment" data-v-8488c362 data-v-8488c362># Action with event `'try_move'`.</span>
    <span class="token comment" data-v-8488c362 data-v-8488c362># ...</span>
</code></pre></div>
<p data-v-8488c362 data-v-8488c362>When our Action with event <code data-v-8488c362 data-v-8488c362>'try_get_interactions'</code> is run, we want to again have a component on our player entity that has a corresponding method. While <code data-v-8488c362 data-v-8488c362>'try_move'</code> had a natural home in our Legs component, I've shoved our interactions event in the Actor component. I might change this later, but it works on the thinking that the Actor represents the entity's "brain", hence would be responsible for "reasoning out" what is interactable and what to do with it.</p>
<h3 id="actor" data-v-8488c362 data-v-8488c362><a href="#actor" aria-hidden="true" tabindex="-1" data-v-8488c362 data-v-8488c362><span class="icon icon-link" data-v-8488c362 data-v-8488c362></span></a>Actor</h3>
<p data-v-8488c362 data-v-8488c362>Unlike the case of <code data-v-8488c362 data-v-8488c362>'try_move'</code> where we just had to run a position update, for interactions we have to do a bit more. Recall that we grabbed a reference to the target interactable, which we now want to make fire an event of its own.</p>
<div class="nuxt-content-highlight" data-v-8488c362 data-v-8488c362><pre class="language-python line-numbers" data-v-8488c362 data-v-8488c362><code data-v-8488c362 data-v-8488c362><span class="token keyword" data-v-8488c362 data-v-8488c362>def</span> <span class="token function" data-v-8488c362 data-v-8488c362>Action</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>Component<span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
    <span class="token comment" data-v-8488c362 data-v-8488c362># ...</span>
    <span class="token keyword" data-v-8488c362 data-v-8488c362>def</span> <span class="token function" data-v-8488c362 data-v-8488c362>on_try_get_interactions</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span>self<span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> evt<span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span> EntityEvent<span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span> <span class="token operator" data-v-8488c362 data-v-8488c362>-</span><span class="token operator" data-v-8488c362 data-v-8488c362>></span> <span class="token boolean" data-v-8488c362 data-v-8488c362>None</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>:</span>
        target <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> evt<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>data<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token string" data-v-8488c362 data-v-8488c362>'target'</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span>
        evt <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> target<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>fire_event<span class="token punctuation" data-v-8488c362 data-v-8488c362>(</span><span class="token string" data-v-8488c362 data-v-8488c362>'get_interactions'</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>,</span> evt<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>data<span class="token punctuation" data-v-8488c362 data-v-8488c362>)</span>
        interactions <span class="token operator" data-v-8488c362 data-v-8488c362>=</span> evt<span class="token punctuation" data-v-8488c362 data-v-8488c362>.</span>data<span class="token punctuation" data-v-8488c362 data-v-8488c362>[</span><span class="token string" data-v-8488c362 data-v-8488c362>'expect'</span><span class="token punctuation" data-v-8488c362 data-v-8488c362>]</span>
        <span class="token comment" data-v-8488c362 data-v-8488c362># ...</span>
</code></pre></div>
<p data-v-8488c362 data-v-8488c362>Let's stop and explore what's happening here. Because ECStremity's event system only fires events to the components on the firing entity, we have to separately pass in a target and "force" it to fire an event of its own to get usable information back from the target's components. We pass the original event's data dict as data for the new event, where we'll want any components on the target to do something with the <code data-v-8488c362 data-v-8488c362>'expect'</code> field. In this case, the field holds a list, so we <i data-v-8488c362 data-v-8488c362>expect</i> (heh...) any and all components to append data for us to work with.</p></div></div></div></div></div> <div class="colorpop rounded-b"></div> <div class="my-6" data-v-2995466f><span class="copyright" data-v-2995466f>© 2019-2021 Jonathan Crum</span></div></div></div></div><script defer src="/_nuxt/static/1615860469/devlog/2021-03-09-anathema/state.js"></script><script src="/_nuxt/10c2450.js" defer></script><script src="/_nuxt/52c57d5.js" defer></script><script src="/_nuxt/4bbc75c.js" defer></script><script src="/_nuxt/4ca9ec1.js" defer></script><script src="/_nuxt/b4dab43.js" defer></script><script src="/_nuxt/2c5d41a.js" defer></script>
  </body>
</html>
